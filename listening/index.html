<!DOCTYPE html>
<html lang="ja">
<head>
  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-PS9R9844');</script>
  <!-- End Google Tag Manager -->
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
  <title>英語リスニングクイズ 無料 | ListenUp — 毎日の耳トレ</title>
  <meta name="description" content="英語リスニング力を鍛える無料クイズ。5段階レベル・毎週問題追加中。あなたの苦手パターン（速い発音・音の変化・語彙など）を自動分析し、弱点に絞った出題に調整。毎日5問から始めて、ネイティブ英語が聴き取れるようになる。">
  <link rel="canonical" href="https://native-real.com/listening/">
  <meta property="og:title" content="英語リスニングクイズ 無料 | ListenUp">
  <meta property="og:description" content="英語リスニング力を鍛える無料クイズ。5段階レベル・弱点パターン自動分析。毎週問題追加中。練習するほどあなたの苦手に合わせた出題になる。">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://native-real.com/listening/">
  <meta property="og:image" content="https://native-real.com/assets/ogp.png">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta property="og:site_name" content="英語学習サービス比較ナビ">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="英語リスニングクイズ 無料 | ListenUp">
  <meta name="twitter:description" content="英語リスニング力を鍛える無料クイズ。5段階レベル対応。毎週問題追加中。毎日5問から始められます。">
  <meta name="twitter:image" content="https://native-real.com/assets/ogp.png">
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebApplication",
    "name": "ListenUp — 英語リスニングクイズ",
    "description": "英語リスニング力を鍛える無料クイズ。5段階レベル対応・弱点パターン自動分析で個人に合った出題に調整。毎週問題追加中。",
    "url": "https://native-real.com/listening/",
    "applicationCategory": "EducationalApplication",
    "operatingSystem": "Web",
    "offers": {
      "@type": "Offer",
      "price": "0",
      "priceCurrency": "JPY"
    },
    "publisher": {
      "@type": "Organization",
      "name": "英語学習サービス比較ナビ",
      "url": "https://native-real.com"
    },
    "inLanguage": "ja",
    "educationalLevel": "Beginner, Intermediate, Advanced",
    "learningResourceType": "Quiz"
  }
  </script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --bg:         #FFFFFF;
      --surface:    rgba(0,0,0,0.04);
      --surface-2:  rgba(0,0,0,0.06);
      --border:     rgba(0,0,0,0.09);
      --gold:       #F5A623;
      --teal:       #0EA5E9;
      --teal-bg:    rgba(14,165,233,0.08);
      --gold-dim:   rgba(245,166,35,0.65);
      --gold-glow:  rgba(245,166,35,0.2);
      --success:    #16A34A;
      --success-bg: rgba(22,163,74,0.1);
      --error:      #DC2626;
      --error-bg:   rgba(220,38,38,0.1);
      --text-1:     rgba(0,0,0,0.88);
      --text-2:     rgba(0,0,0,0.62);
      --text-3:     rgba(0,0,0,0.46);
      --radius:     16px;
      --radius-lg:  20px;
      --t:          0.18s ease;
    }

    html {
      scroll-behavior: smooth;
    }

    html, body { height: 100%; }

    body {
      font-family: 'Inter', 'Noto Sans JP', -apple-system, BlinkMacSystemFont, sans-serif;
      font-size: 16px;
      background: var(--bg);
      background-image: radial-gradient(rgba(0,0,0,0.05) 1px, transparent 1px);
      background-size: 28px 28px;
      color: var(--text-1);
      -webkit-font-smoothing: antialiased;
      font-feature-settings: 'palt';
      letter-spacing: 0.01em;
      line-height: 1.7;
    }

    /* ── BACKGROUND ORBS ── */
    .orb {
      position: fixed;
      border-radius: 50%;
      pointer-events: none;
      z-index: 0;
      filter: blur(80px);
    }
    .orb-1 {
      width: 700px; height: 700px;
      background: radial-gradient(circle at center, rgba(59,91,219,0.10), transparent 70%);
      top: -250px; left: -200px;
      animation: float1 16s ease-in-out infinite;
    }
    .orb-2 {
      width: 500px; height: 500px;
      background: radial-gradient(circle at center, rgba(245,166,35,0.16), transparent 70%);
      top: 25%; right: -150px;
      animation: float2 20s ease-in-out infinite;
    }
    .orb-3 {
      width: 450px; height: 450px;
      background: radial-gradient(circle at center, rgba(124,58,237,0.08), transparent 70%);
      bottom: -100px; left: 15%;
      animation: float3 24s ease-in-out infinite;
    }
    @keyframes float1 {
      0%, 100% { transform: translate(0, 0); }
      33%       { transform: translate(40px, 30px); }
      66%       { transform: translate(-20px, 50px); }
    }
    @keyframes float2 {
      0%, 100% { transform: translate(0, 0); }
      40%       { transform: translate(-30px, -40px); }
      70%       { transform: translate(20px, -20px); }
    }
    @keyframes float3 {
      0%, 100% { transform: translate(0, 0); }
      30%       { transform: translate(50px, -30px); }
      60%       { transform: translate(-20px, 40px); }
    }

    .screen, .app-header, .mockup-banner { position: relative; z-index: 1; }


    /* ── HEADER ── */
    .app-header {
      background: rgba(255,255,255,0.92);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border-bottom: 1px solid var(--border);
      height: 56px;
      padding: 0 20px;
      display: none;
      align-items: center;
      justify-content: space-between;
      position: sticky;
      top: 0;
      z-index: 100;
    }
    .header-logo {
      font-size: 17px; font-weight: 800; letter-spacing: -0.5px;
      display: flex; align-items: center; gap: 10px;
      color: var(--text-1);
    }
    .header-logo svg { width: 22px; height: 22px; color: var(--gold); flex-shrink: 0; }
    .header-right { display: flex; align-items: center; gap: 14px; }
    .score-wrap { font-size: 13px; color: var(--text-3); }
    .score-num { font-size: 19px; font-weight: 800; color: var(--gold); display: inline-block; }
    .reset-btn {
      background: rgba(0,0,0,0.04); border: 1px solid var(--border);
      color: var(--text-2); border-radius: 8px; padding: 8px 14px;
      font-size: 12px; cursor: pointer; transition: all var(--t);
      min-height: 44px;
    }
    .reset-btn:hover { background: rgba(0,0,0,0.07); color: var(--text-1); }

    /* ── SCREENS ── */
    .screen { display: none; }
    .screen.active { display: block; }

    /* ═══════════════════════════════════════════
       LANDING PAGE
    ═══════════════════════════════════════════ */

    .lp-wrap {
      max-width: 900px;
      margin: 0 auto;
      padding: 0 20px;
    }

    /* ── HERO ── */
    .lp-hero {
      min-height: calc(100svh - 36px);
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      padding: 64px 20px 80px;
    }
    .lp-hero-inner { max-width: 720px; margin: 0 auto; }

    .hero-eyebadge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: rgba(245,166,35,0.09);
      border: 1px solid rgba(245,166,35,0.22);
      color: var(--gold);
      font-size: 12px;
      font-weight: 700;
      letter-spacing: 1.2px;
      text-transform: uppercase;
      padding: 5px 14px;
      border-radius: 20px;
      margin-bottom: 28px;
      animation: fadeUp 0.6s ease-out both;
    }

    .hero-h1 {
      font-size: clamp(36px, 7vw, 68px);
      font-weight: 900;
      letter-spacing: -1.5px;
      line-height: 1.08;
      margin-bottom: 22px;
      animation: fadeUp 0.6s 0.1s ease-out both;
    }

    .text-gold {
      background: linear-gradient(120deg, var(--gold) 0%, #F8C347 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .hero-sub {
      font-size: clamp(17px, 2.4vw, 21px);
      color: var(--text-2);
      line-height: 1.85;
      margin-bottom: 40px;
      animation: fadeUp 0.6s 0.2s ease-out both;
    }

    .hero-ctas {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 12px;
      margin-bottom: 18px;
      animation: fadeUp 0.6s 0.3s ease-out both;
    }

    @media (min-width: 500px) {
      .hero-ctas { flex-direction: row; justify-content: center; }
    }

    .btn-primary-lg {
      display: inline-flex; align-items: center; gap: 8px;
      background: linear-gradient(135deg, #E09520 0%, #F5A623 50%, #F8C347 100%);
      color: #000; font-weight: 800; font-size: 17px;
      border: none; border-radius: 50px; padding: 18px 32px;
      cursor: pointer; transition: all var(--t);
      box-shadow: 0 4px 24px rgba(245,166,35,0.3);
      white-space: nowrap;
    }
    .btn-primary-lg:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 40px rgba(245,166,35,0.5);
      filter: brightness(1.05);
    }
    .btn-primary-lg:active { transform: translateY(0); }

    .btn-ghost {
      display: inline-flex; align-items: center; gap: 8px;
      background: rgba(0,0,0,0.04);
      color: var(--text-2); font-weight: 600; font-size: 16px;
      border: 1px solid var(--border); border-radius: 50px; padding: 18px 28px;
      cursor: pointer; transition: all var(--t);
      white-space: nowrap;
    }
    .btn-ghost:hover {
      background: rgba(0,0,0,0.07);
      color: var(--text-1);
      border-color: rgba(0,0,0,0.18);
    }

    .hero-fine {
      font-size: 13px;
      color: var(--text-3);
      letter-spacing: 0.01em;
      animation: fadeUp 0.6s 0.4s ease-out both;
    }

    @keyframes fadeUp {
      from { opacity: 0; transform: translateY(16px); }
      to   { opacity: 1; transform: translateY(0); }
    }


    /* ── FEATURE STRIP ── */
    .feature-strip {
      display: flex;
      align-items: stretch;
      justify-content: center;
      flex-wrap: wrap;
      gap: 0;
      background: rgba(0,0,0,0.03);
      border-top: 1px solid var(--border);
      border-bottom: 1px solid var(--border);
    }
    .feature-item {
      display: flex;
      align-items: center;
      gap: 16px;
      padding: 24px 36px;
      border-right: 1px solid var(--border);
    }
    .feature-item:last-child { border-right: none; }
    .feature-icon {
      width: 48px; height: 48px;
      border-radius: 12px;
      background: rgba(14,165,233,0.08);
      border: 1px solid rgba(14,165,233,0.14);
      display: flex; align-items: center; justify-content: center;
      flex-shrink: 0;
      color: var(--teal);
    }
    .feature-icon svg { width: 22px; height: 22px; }
    .feature-text strong {
      display: block;
      font-size: 15px;
      font-weight: 700;
      color: var(--text-1);
      line-height: 1.4;
      letter-spacing: 0.01em;
    }
    .feature-text span {
      font-size: 13px;
      color: var(--text-3);
    }
    @media (max-width: 600px) {
      .feature-strip { flex-direction: column; }
      .feature-item { border-right: none; border-bottom: 1px solid var(--border); }
      .feature-item:last-child { border-bottom: none; }
    }

    /* ── SECTIONS ── */
    .lp-section {
      padding: 88px 0;
    }
    .lp-section-alt {
      padding: 88px 0;
      background: #F7F8FA;
      border-top: 1px solid var(--border);
      border-bottom: 1px solid var(--border);
    }

    /* ── PHILOSOPHY ── */
    .philosophy-section {
      padding: 88px 0 96px;
      background: linear-gradient(180deg, #F5F7FA 0%, #EEF2F7 60%, #F5F7FA 100%);
      border-top: 1px solid rgba(245,166,35,.12);
      border-bottom: 1px solid rgba(245,166,35,.12);
      position: relative;
      overflow: hidden;
    }
    .philosophy-section::before {
      content: '';
      position: absolute;
      inset: 0;
      background: radial-gradient(ellipse 80% 60% at 50% 0%, rgba(245,166,35,.04) 0%, transparent 70%);
      pointer-events: none;
    }
    .philosophy-wrap {
      max-width: 620px;
      margin: 0 auto;
      padding: 0 24px;
    }
    .philosophy-eyebrow {
      font-size: 12px;
      font-weight: 700;
      letter-spacing: 3px;
      text-transform: uppercase;
      color: var(--gold);
      margin-bottom: 40px;
      text-align: center;
    }
    /* 感情的フック */
    .philosophy-hook {
      font-size: clamp(20px, 2.6vw, 24px);
      color: rgba(0,0,0,.78);
      font-weight: 500;
      line-height: 1.9;
      text-align: center;
      margin-bottom: 28px;
    }
    /* 説明文 */
    .philosophy-desc {
      font-size: clamp(15px, 1.8vw, 16px);
      color: rgba(0,0,0,.65);
      line-height: 1.9;
      margin-bottom: 32px;
    }
    /* 大きな問いかけ */
    .philosophy-question {
      font-size: clamp(22px, 3.2vw, 30px);
      font-weight: 800;
      color: rgba(0,0,0,.88);
      line-height: 1.55;
      text-align: center;
      margin-bottom: 56px;
      letter-spacing: -0.5px;
    }
    .philosophy-question em {
      font-style: normal;
      color: var(--gold);
    }
    .philosophy-divider {
      width: 1px;
      height: 56px;
      background: linear-gradient(to bottom, transparent, rgba(245,166,35,.35), transparent);
      margin: 0 auto 48px;
    }
    /* 洞察テキスト */
    .philosophy-insight {
      font-size: clamp(16px, 2vw, 18px);
      color: rgba(0,0,0,.72);
      line-height: 1.95;
      margin-bottom: 20px;
    }
    .philosophy-insight:last-of-type { margin-bottom: 44px; }
    .philosophy-insight strong { color: rgba(0,0,0,.88); font-weight: 700; }
    /* 引用ブロック */
    .philosophy-quote {
      border: none;
      padding: 32px 28px 32px 32px;
      margin: 0 0 44px;
      background: rgba(245,166,35,.07);
      border-left: 4px solid var(--gold);
      border-radius: 0 14px 14px 0;
    }
    .philosophy-quote p {
      font-size: clamp(18px, 2.5vw, 23px);
      font-weight: 700;
      color: rgba(0,0,0,.80);
      line-height: 1.75;
    }
    /* 締めテキスト */
    .philosophy-body {
      font-size: clamp(15px, 1.9vw, 17px);
      color: rgba(0,0,0,.68);
      line-height: 1.95;
      margin-bottom: 0;
    }
    .philosophy-body strong { color: rgba(0,0,0,.88); }
    /* 結論ボックス */
    .philosophy-conclusion {
      margin-top: 48px;
      padding: 32px;
      background: #fff;
      border: 1px solid rgba(245,166,35,.22);
      border-radius: 16px;
      text-align: center;
      box-shadow: 0 4px 24px rgba(0,0,0,.05);
    }
    .philosophy-conclusion p {
      font-size: clamp(16px, 2vw, 19px);
      color: rgba(0,0,0,.80);
      line-height: 1.85;
      margin-bottom: 8px;
    }
    .philosophy-conclusion p:last-child { margin-bottom: 0; }
    .philosophy-conclusion strong { color: var(--gold); }
    .philosophy-tagline {
      font-size: 14px !important;
      color: rgba(0,0,0,.50) !important;
      font-style: italic;
      margin-top: 12px !important;
    }

    .section-eyebrow {
      font-size: 12px;
      font-weight: 700;
      letter-spacing: 3px;
      text-transform: uppercase;
      color: var(--gold);
      margin-bottom: 16px;
    }
    .section-h2 {
      font-size: clamp(28px, 4.5vw, 44px);
      font-weight: 800;
      letter-spacing: -1px;
      line-height: 1.15;
      margin-bottom: 52px;
    }

    /* ── HOW IT WORKS ── */
    .steps-row {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }
    @media (min-width: 700px) {
      .steps-row {
        flex-direction: row;
        align-items: stretch;
        gap: 0;
      }
    }

    .step-card {
      flex: 1;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius-lg);
      padding: 28px 24px;
      text-align: center;
      backdrop-filter: blur(8px);
      transition: border-color 0.25s, transform 0.25s;
    }
    .step-card:hover {
      border-color: rgba(245,166,35,0.3);
      transform: translateY(-3px);
    }

    .step-connector {
      display: none;
      align-items: center;
      justify-content: center;
      padding: 0 12px;
      color: var(--text-3);
      font-size: 22px;
      flex-shrink: 0;
    }
    @media (min-width: 700px) { .step-connector { display: flex; } }

    .step-no {
      font-size: 11px;
      font-weight: 700;
      letter-spacing: 1px;
      color: var(--gold);
      margin-bottom: 14px;
    }
    .step-icon {
      width: 64px; height: 64px;
      border-radius: 18px;
      background: rgba(245,166,35,0.08);
      border: 1px solid rgba(245,166,35,0.16);
      display: flex; align-items: center; justify-content: center;
      margin: 0 auto 16px;
      color: var(--gold);
    }
    .step-icon svg { width: 28px; height: 28px; }
    .step-card h3 { font-size: 20px; font-weight: 800; margin-bottom: 12px; letter-spacing: -0.3px; }
    .step-card p  { font-size: 15px; color: var(--text-2); line-height: 1.75; }

    /* ── PRICING ── */
    .pricing-row {
      display: flex;
      flex-direction: column;
      gap: 20px;
      margin-bottom: 56px;
    }
    @media (min-width: 640px) {
      .pricing-row {
        flex-direction: row;
        align-items: stretch;
      }
    }

    .pricing-card {
      flex: 1;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 20px;
      padding: 32px 28px;
      backdrop-filter: blur(10px);
      position: relative;
      display: flex;
      flex-direction: column;
    }

    .plan-label {
      font-size: 14px;
      font-weight: 700;
      color: var(--text-3);
      letter-spacing: 0.5px;
      text-transform: uppercase;
      margin-bottom: 14px;
    }
    .plan-price-wrap {
      display: flex;
      align-items: baseline;
      gap: 4px;
      margin-bottom: 6px;
    }
    .plan-price {
      font-size: 44px;
      font-weight: 900;
      letter-spacing: -2px;
      color: var(--text-1);
    }
    
    .plan-per {
      font-size: 15px;
      color: var(--text-2);
      font-weight: 500;
    }
    .plan-trial-text {
      font-size: 12px;
      color: var(--success);
      font-weight: 600;
      margin-bottom: 24px;
    }

    .plan-feats {
      list-style: none;
      flex: 1;
      margin-bottom: 28px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    .plan-feats li {
      font-size: 15px;
      display: flex;
      align-items: center;
      gap: 10px;
      line-height: 1.5;
    }
    .feat-ok { color: var(--text-1); }
    .feat-ng { color: var(--text-3); text-decoration: line-through; }
    .feat-ok::before { content: '✓'; color: var(--success); font-weight: 700; flex-shrink: 0; }
    .feat-ng::before { content: '✗'; color: var(--text-3); font-weight: 700; flex-shrink: 0; }

    .plan-btn {
      width: 100%;
      border: none;
      border-radius: 50px;
      padding: 15px;
      font-size: 15px;
      font-weight: 700;
      cursor: pointer;
      transition: all var(--t);
    }
    .plan-btn-gold {
      background: linear-gradient(135deg, #E09520 0%, #F5A623 50%, #F8C347 100%);
      color: #000;
      box-shadow: 0 4px 20px rgba(245,166,35,0.28);
    }
    .plan-btn-gold:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 36px rgba(245,166,35,0.45);
      filter: brightness(1.05);
    }
    .plan-btn-ghost {
      background: rgba(0,0,0,0.05);
      color: var(--text-2);
      border: 1px solid var(--border);
    }
    .plan-btn-ghost:hover {
      background: rgba(0,0,0,0.08);
      color: var(--text-1);
    }
    /* Monitor plan (teal) */
    .pricing-monitor {
      border-color: #14B8A6;
      background: rgba(20,184,166,0.05);
      box-shadow: 0 0 48px rgba(20,184,166,0.12), 0 0 0 1px rgba(20,184,166,0.25);
    }
    .plan-rec-badge-teal {
      position: absolute;
      top: -12px;
      left: 50%;
      transform: translateX(-50%);
      background: linear-gradient(135deg, #0D9488, #14B8A6);
      color: #fff;
      font-size: 11px;
      font-weight: 800;
      letter-spacing: 0.5px;
      text-transform: uppercase;
      padding: 4px 14px;
      border-radius: 20px;
      white-space: nowrap;
    }
    .pricing-monitor .plan-price { color: #14B8A6; }
    .plan-btn-teal {
      background: linear-gradient(135deg, #0D9488 0%, #14B8A6 50%, #2DD4BF 100%);
      color: #fff;
      box-shadow: 0 4px 20px rgba(20,184,166,0.28);
    }
    .plan-btn-teal:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 36px rgba(20,184,166,0.45);
      filter: brightness(1.05);
    }
    .spots-display {
      margin: 14px 0 20px;
      font-size: 13px;
      font-weight: 600;
      color: var(--text-2);
    }
    .spots-num { color: #14B8A6; font-weight: 800; }
    .spots-bar {
      height: 4px;
      background: rgba(0,0,0,0.08);
      border-radius: 2px;
      margin-top: 6px;
      overflow: hidden;
    }
    .spots-fill {
      height: 100%;
      width: 85%;
      background: linear-gradient(90deg, #0D9488, #14B8A6);
      border-radius: 2px;
    }
    .feat-star { color: var(--text-1); font-weight: 600; }
    .feat-star::before { content: '★'; color: #14B8A6; font-weight: 700; flex-shrink: 0; }

    /* ── COMPARISON TABLE ── */
    .compare-section {
      padding: 60px 24px 60px;
    }
    .compare-inner { max-width: 760px; margin: 0 auto; }
    .compare-lead {
      text-align: center; margin-bottom: 28px;
    }
    .compare-lead p {
      font-size: 14px; color: var(--text-2); margin-top: 6px; line-height: 1.6;
    }
    .compare-scroll { overflow-x: auto; -webkit-overflow-scrolling: touch; }
    .compare-table {
      width: 100%; border-collapse: collapse; min-width: 520px;
      font-size: 13px;
    }
    .compare-table th {
      padding: 10px 12px; font-weight: 700; font-size: 12px;
      letter-spacing: 0.3px; border-bottom: 2px solid var(--border);
      white-space: nowrap;
    }
    .compare-table th.col-self {
      background: rgba(245,166,35,0.08);
      border-bottom-color: var(--gold);
      color: var(--gold);
    }
    .compare-table td {
      padding: 10px 12px; border-bottom: 1px solid var(--border);
      color: var(--text-2); vertical-align: middle;
    }
    .compare-table tr:last-child td { border-bottom: none; }
    .compare-table td.col-self {
      background: rgba(245,166,35,0.04);
      font-weight: 700; color: var(--text-1);
    }
    .compare-table td.col-label {
      font-weight: 600; color: var(--text-1); font-size: 13px; white-space: nowrap;
    }
    .compare-mark-ok  { color: var(--success); font-weight: 800; }
    .compare-mark-ng  { color: var(--error);   font-weight: 700; opacity: 0.6; }
    .compare-mark-mid { color: var(--text-3);  font-weight: 600; }
    .compare-price-self { color: var(--gold); font-weight: 800; font-size: 15px; }

    /* ── RETURNING STATS PANEL ── */
    .returning-stats {
      display: none;
      align-items: center;
      justify-content: center;
      gap: 0;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 14px 0;
      margin: 0 auto 28px;
      max-width: 400px;
      width: 100%;
      animation: fadeUp 0.6s 0.15s ease-out both;
    }
    .rs-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 2px;
      padding: 0 24px;
    }
    .rs-item span {
      font-size: 22px;
      font-weight: 800;
      color: var(--gold);
      letter-spacing: -0.5px;
      line-height: 1.1;
    }
    .rs-item small {
      font-size: 11px;
      color: var(--text-3);
      letter-spacing: 0.2px;
    }
    .rs-divider {
      width: 1px;
      height: 32px;
      background: var(--border);
      flex-shrink: 0;
    }

    /* ── DAILY MISSION DOTS (free-banner 内) ── */
    .dm-dots-wrap {
      display: inline-flex; align-items: center; gap: 5px; margin-right: 10px;
    }
    .dm-dot {
      width: 9px; height: 9px; border-radius: 50%;
      background: rgba(0,0,0,0.15);
      transition: background 0.25s, transform 0.2s;
    }
    .dm-dot.filled { background: var(--gold); }
    .dm-dot.filled-recent { background: var(--gold); transform: scale(1.35); }

    /* ── MISSION COMPLETE OVERLAY ── */
    .mission-overlay {
      display: none;
      position: fixed; inset: 0; z-index: 600;
      background: rgba(0,0,0,0.45);
      backdrop-filter: blur(16px); -webkit-backdrop-filter: blur(16px);
      align-items: center; justify-content: center; padding: 20px;
      animation: fadeIn 0.25s ease-out;
    }
    .mission-overlay.show { display: flex; }
    .mission-modal {
      background: #FFFFFF;
      border: 1px solid rgba(52,211,153,0.28);
      border-radius: 24px; padding: 36px 28px 28px;
      max-width: 360px; width: 100%; text-align: center;
      box-shadow: 0 8px 40px rgba(0,0,0,0.15);
      animation: slideUp 0.3s ease-out; backdrop-filter: blur(20px);
    }
    .mission-emoji { font-size: 46px; margin-bottom: 8px; }
    .mission-title {
      font-size: 21px; font-weight: 800; letter-spacing: -0.4px; margin-bottom: 6px;
      background: linear-gradient(120deg, #34D399, #6EE7B7);
      -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
    }
    .mission-streak { font-size: 14px; color: var(--gold); font-weight: 700; margin-bottom: 18px; }
    .mission-score-wrap {
      display: flex; align-items: center; justify-content: center;
      background: var(--surface); border: 1px solid var(--border);
      border-radius: 14px; padding: 14px 0; margin-bottom: 16px;
    }
    .mission-score-item {
      flex: 1; display: flex; flex-direction: column; align-items: center; gap: 2px;
    }
    .mission-score-item span { font-size: 26px; font-weight: 800; color: var(--text-1); letter-spacing: -0.5px; }
    .mission-score-item small { font-size: 12px; color: var(--text-3); }
    .mission-score-divider { width: 1px; height: 34px; background: var(--border); }
    .mission-week {
      display: flex; justify-content: center; gap: 8px; margin-bottom: 20px;
    }
    .mw-day { display: flex; flex-direction: column; align-items: center; gap: 4px; }
    .mw-label { font-size: 10px; color: var(--text-3); }
    .mw-dot { width: 10px; height: 10px; border-radius: 50%; background: rgba(0,0,0,0.1); }
    .mw-dot.done  { background: var(--success); }
    .mw-dot.today { background: var(--gold); }
    .mission-btn-back {
      width: 100%; background: rgba(0,0,0,0.05); color: var(--text-2);
      font-weight: 600; font-size: 14px; border: 1px solid var(--border);
      border-radius: 12px; padding: 13px; cursor: pointer; transition: all var(--t);
      margin-bottom: 10px; min-height: 44px;
    }
    .mission-btn-back:hover { background: rgba(0,0,0,0.08); color: var(--text-1); }

    /* ── MISSION: AXIS WEAKNESS ── */
    .mission-axis-wrap { margin: 4px 0 16px; padding: 12px 14px; background: var(--surface); border-radius: 10px; text-align: left; }
    .mission-axis-label { font-size: 11px; font-weight: 700; color: var(--text-3); letter-spacing: 0.5px; margin-bottom: 10px; }
    .mission-axis-rows { display: flex; flex-direction: column; gap: 7px; }
    .mission-axis-row { display: flex; align-items: center; gap: 8px; }
    .mission-axis-name { font-size: 12px; color: var(--text-2); width: 90px; flex-shrink: 0; }
    .mission-axis-bar-wrap { flex: 1; background: var(--border); border-radius: 4px; height: 5px; overflow: hidden; }
    .mission-axis-bar { height: 100%; border-radius: 4px; background: var(--gold); transition: width 0.7s ease; }
    .mission-axis-bar.weak { background: #ef4444; }
    .mission-axis-bar.strong { background: #22c55e; }
    .mission-axis-pct { font-size: 11px; color: var(--text-3); width: 30px; text-align: right; flex-shrink: 0; }
    .mission-axis-msg { font-size: 12px; color: var(--text-2); margin: 10px 0 0; line-height: 1.6; }
    .mission-axis-msg strong { color: var(--text-1); font-weight: 700; }

    /* ── MISSION: ARTICLE LINKS ── */
    .mission-articles {
      border-top: 1px solid var(--border);
      padding-top: 14px; margin: 4px 0 18px; text-align: left;
    }
    .mission-articles-label {
      font-size: 11px; font-weight: 700; color: var(--text-3);
      letter-spacing: 0.6px; text-align: center; margin-bottom: 10px;
    }
    .mission-article-link {
      display: flex; align-items: flex-start; gap: 7px;
      padding: 7px 10px; border-radius: 8px; margin-bottom: 3px;
      font-size: 12.5px; color: var(--text-2); text-decoration: none;
      transition: all var(--t); line-height: 1.45;
    }
    .mission-article-link::before { content: "→"; color: var(--gold); font-weight: 700; flex-shrink: 0; }
    .mission-article-link:hover { background: var(--surface); color: var(--text-1); }

    /* ── LP: BOTTOM EMAIL CTA ── */
    .lp-bottom-cta {
      background: linear-gradient(160deg, #060d1a 0%, #0b1a30 55%, #081320 100%);
      padding: 72px 24px 80px;
      text-align: center;
    }
    .lp-bcta-wrap { max-width: 480px; margin: 0 auto; }
    .lp-bcta-eyebrow {
      font-size: 11px; font-weight: 700; letter-spacing: 2px;
      color: var(--gold); text-transform: uppercase; margin-bottom: 14px;
    }
    .lp-bcta-h {
      font-size: clamp(22px, 6vw, 30px); font-weight: 900; letter-spacing: -0.8px;
      line-height: 1.3; color: #fff; margin-bottom: 10px;
    }
    .lp-bcta-sub {
      font-size: 14px; color: rgba(255,255,255,0.5); line-height: 1.7; margin-bottom: 28px;
    }
    .lp-bcta-form { display: flex; flex-direction: column; gap: 10px; }
    .lp-bcta-input {
      width: 100%; background: rgba(255,255,255,0.07);
      border: 1px solid rgba(255,255,255,0.18); border-radius: 12px;
      padding: 14px 16px; font-size: 15px; color: #fff; outline: none;
      transition: border-color 0.18s; box-sizing: border-box;
    }
    .lp-bcta-input::placeholder { color: rgba(255,255,255,0.32); }
    .lp-bcta-input:focus { border-color: rgba(245,166,35,0.65); }
    .lp-bcta-field-group { margin-bottom: 2px; text-align: left; }
    .lp-bcta-field-label {
      font-size: 12px; font-weight: 700; color: rgba(255,255,255,0.5);
      margin-bottom: 7px; display: block;
    }
    .lp-bcta-radio-row { display: flex; flex-wrap: wrap; gap: 6px; }
    .lp-bcta-radio-btn { cursor: pointer; }
    .lp-bcta-radio-btn input { display: none; }
    .lp-bcta-radio-btn span {
      display: inline-block; padding: 5px 10px;
      border: 1px solid rgba(255,255,255,0.2); border-radius: 20px;
      font-size: 12px; font-weight: 600; color: rgba(255,255,255,0.5);
      transition: all 0.15s;
    }
    .lp-bcta-radio-btn input:checked + span {
      background: rgba(245,166,35,0.18); border-color: var(--gold); color: var(--gold);
    }
    .lp-bcta-radio-btn:hover span { border-color: rgba(245,166,35,0.4); }
    .lp-bcta-select {
      width: 100%; background: rgba(255,255,255,0.07);
      border: 1px solid rgba(255,255,255,0.18); border-radius: 12px;
      padding: 12px 16px; font-size: 14px; color: rgba(255,255,255,0.7);
      outline: none; transition: border-color 0.18s; cursor: pointer;
      -webkit-appearance: none; box-sizing: border-box;
    }
    .lp-bcta-select option { background: #0d1a30; color: #fff; }
    .lp-bcta-select:focus { border-color: rgba(245,166,35,0.55); }
    .lp-bcta-submit {
      width: 100%; background: linear-gradient(135deg, #E09520 0%, #F5A623 50%, #F8C347 100%);
      color: #1a1000; border: none; border-radius: 12px;
      padding: 16px; font-size: 16px; font-weight: 800;
      cursor: pointer; transition: all 0.18s;
      box-shadow: 0 4px 24px rgba(245,166,35,0.35);
      min-height: 52px; margin-top: 4px;
    }
    .lp-bcta-submit:hover { transform: translateY(-2px); box-shadow: 0 8px 36px rgba(245,166,35,0.5); }
    .lp-bcta-submit:disabled { opacity: 0.45; cursor: not-allowed; transform: none; box-shadow: none; }
    .lp-bcta-consent {
      font-size: 11px; color: rgba(255,255,255,0.3); line-height: 1.6; margin-top: 2px;
    }
    .lp-bcta-consent a { color: rgba(255,255,255,0.45); text-decoration: underline; }
    .lp-bcta-skip {
      font-size: 13px; color: rgba(255,255,255,0.38); text-decoration: underline;
      cursor: pointer; background: none; border: none; margin-top: 16px;
      transition: color 0.15s; display: block; width: 100%;
    }
    .lp-bcta-skip:hover { color: rgba(255,255,255,0.6); }

    /* ── LP: FOOTER ── */
    .lp-footer {
      padding: 24px 20px; text-align: center;
      font-size: 12px; color: var(--text-3);
      border-top: 1px solid var(--border);
      background: var(--bg);
    }

    /* ── LP: ARTICLE COLUMN SECTION ── */
    .lp-articles {
      padding: 52px 24px; border-top: 1px solid var(--border);
    }
    .lp-articles-inner { max-width: 720px; margin: 0 auto; }
    .lp-articles-eyebrow {
      font-size: 11px; font-weight: 700; color: var(--text-3);
      letter-spacing: 1.5px; text-align: center; margin-bottom: 8px;
    }
    .lp-articles-h { font-size: 18px; font-weight: 800; color: var(--text-1); text-align: center; margin-bottom: 24px; }
    .lp-articles-grid {
      display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px;
    }
    @media (max-width: 520px) { .lp-articles-grid { grid-template-columns: 1fr; } }
    .lp-article-card {
      display: block; padding: 14px 16px; background: var(--surface);
      border: 1px solid var(--border); border-radius: 12px;
      text-decoration: none; transition: all var(--t);
    }
    .lp-article-card:hover { border-color: var(--gold); transform: translateY(-2px); }
    .lp-article-tag { font-size: 10px; font-weight: 700; color: var(--gold); letter-spacing: 0.5px; margin-bottom: 5px; }
    .lp-article-title { font-size: 13px; font-weight: 600; color: var(--text-1); line-height: 1.5; }

    /* ── LANDING: STREAK STATUS ── */
    .streak-status-wrap {
      display: none; align-items: center; justify-content: center;
      gap: 8px; margin: 0 auto 14px; max-width: 400px; width: 100%;
      border-radius: 12px; padding: 9px 16px;
    }
    .streak-status-wrap.not-done {
      background: rgba(245,166,35,0.07); border: 1px solid rgba(245,166,35,0.2);
    }
    .streak-status-wrap.done {
      background: rgba(52,211,153,0.07); border: 1px solid rgba(52,211,153,0.2);
    }
    .streak-status-text { font-size: 13px; font-weight: 600; }
    .streak-status-wrap.not-done .streak-status-text { color: rgba(245,166,35,0.85); }
    .streak-status-wrap.done     .streak-status-text { color: rgba(52,211,153,0.85); }

    /* ── LANDING: WEEKLY CALENDAR ── */
    .weekly-cal-wrap {
      display: none; align-items: center; justify-content: center;
      gap: 10px; margin: 0 auto 24px; max-width: 320px; width: 100%;
    }
    .wk-item { display: flex; flex-direction: column; align-items: center; gap: 5px; }
    .wk-label { font-size: 10px; color: var(--text-3); letter-spacing: 0.2px; }
    .wk-dot {
      width: 11px; height: 11px; border-radius: 50%;
      background: rgba(0,0,0,0.1); transition: background 0.2s;
    }
    .wk-dot.done         { background: var(--success); }
    .wk-dot.today-done   { background: var(--gold); }
    .wk-dot.today-pending { background: rgba(245,166,35,0.3); border: 1px dashed rgba(245,166,35,0.5); }
    .wk-dot.future       { background: rgba(0,0,0,0.08); }

    /* ═══════════════════════════════════════════
       QUIZ SCREEN (mobile-first base)
    ═══════════════════════════════════════════ */

    .content {
      max-width: 480px;
      margin: 0 auto;
      padding: 20px 16px 48px;
    }

    /* ── QUESTION META ── */
    .quiz-meta {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 14px;
    }
    .q-counter {
      font-size: 13px;
      font-weight: 700;
      color: var(--text-3);
      letter-spacing: 0.3px;
    }

    /* ── LOADING VIEW ── */
    .loading-view {
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 300px;
      gap: 16px;
    }
    .loading-view.show { display: flex; }
    .spinner {
      width: 40px; height: 40px;
      border: 3px solid var(--border);
      border-top-color: var(--teal);
      border-radius: 50%;
      animation: spin 0.7s linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }
    .loading-text { font-size: 14px; color: var(--text-3); }

    /* ── QUESTION VIEW ── */
    .question-view { display: none; }
    .question-view.show { display: block; }

    /* ── AUDIO CARD ── */
    .audio-card {
      background: linear-gradient(145deg, #0f3460 0%, #16213e 45%, #1a4a6e 100%);
      border-radius: 18px;
      padding: 20px 20px 16px;
      margin-bottom: 14px;
      position: relative;
      overflow: hidden;
    }
    .audio-card::before {
      content: '';
      position: absolute;
      inset: 0;
      background: radial-gradient(ellipse at 75% 15%, rgba(14,165,233,0.25) 0%, transparent 55%);
      pointer-events: none;
    }
    .audio-label {
      font-size: 10px;
      font-weight: 700;
      letter-spacing: 1.5px;
      text-transform: uppercase;
      color: rgba(255,255,255,0.5);
      margin-bottom: 10px;
    }
    .accent-badge {
      display: inline-block;
      font-size: 10px;
      font-weight: 700;
      color: rgba(255,255,255,0.6);
      background: rgba(255,255,255,0.1);
      border: 1px solid rgba(255,255,255,0.15);
      border-radius: 20px;
      padding: 2px 9px;
      margin-bottom: 10px;
    }
    .accent-badge:empty { display: none; }

    /* ── WAVEFORM ── */
    .waveform {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 4px;
      height: 36px;
      margin-bottom: 12px;
    }
    .bar {
      width: 4px;
      background: rgba(255,255,255,0.25);
      border-radius: 3px;
      height: 14px;
      transition: background 0.3s;
    }
    .waveform.playing .bar { background: rgba(255,255,255,0.8); animation: wave-anim 1.2s ease-in-out infinite; }
    .waveform.playing .bar:nth-child(1)  { height: 10px; animation-delay: 0.00s; }
    .waveform.playing .bar:nth-child(2)  { height: 22px; animation-delay: 0.10s; }
    .waveform.playing .bar:nth-child(3)  { height: 30px; animation-delay: 0.20s; }
    .waveform.playing .bar:nth-child(4)  { height: 20px; animation-delay: 0.08s; }
    .waveform.playing .bar:nth-child(5)  { height: 34px; animation-delay: 0.16s; }
    .waveform.playing .bar:nth-child(6)  { height: 26px; animation-delay: 0.28s; }
    .waveform.playing .bar:nth-child(7)  { height: 18px; animation-delay: 0.12s; }
    .waveform.playing .bar:nth-child(8)  { height: 28px; animation-delay: 0.22s; }
    .waveform.playing .bar:nth-child(9)  { height: 16px; animation-delay: 0.06s; }
    .waveform.playing .bar:nth-child(10) { height: 12px; animation-delay: 0.18s; }
    @keyframes wave-anim {
      0%, 100% { transform: scaleY(0.4); opacity: 0.5; }
      50%       { transform: scaleY(1);   opacity: 1; }
    }

    /* ── PLAY BUTTON ── */
    .play-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      width: 100%;
      background: rgba(255,255,255,0.14);
      border: 1.5px solid rgba(255,255,255,0.22);
      border-radius: 50px;
      color: #fff;
      font-size: 14px;
      font-weight: 700;
      padding: 11px 20px;
      cursor: pointer;
      transition: all 0.18s;
      min-height: 44px;
    }
    .play-btn:hover { background: rgba(255,255,255,0.22); border-color: rgba(255,255,255,0.38); }
    .play-btn.playing { background: rgba(255,255,255,0.2); }

    /* ── QUESTION LABEL ── */
    .question-label {
      font-size: 14px;
      font-weight: 700;
      color: var(--text-1);
      margin-bottom: 12px;
      line-height: 1.5;
    }

    /* ── HINT PANEL ── */
    .hint-panel {
      display: none;
      background: rgba(245,166,35,0.07);
      border: 1px solid rgba(245,166,35,0.22);
      border-radius: 12px;
      padding: 12px 14px;
      margin-bottom: 12px;
    }
    .hint-panel.show { display: block; }
    .hint-label { font-size: 12px; font-weight: 700; color: var(--gold); margin-bottom: 6px; }
    .hint-kp    { font-size: 13px; font-weight: 600; color: var(--text-1); margin-bottom: 4px; }
    .hint-expl  { font-size: 12px; color: var(--text-2); line-height: 1.55; }
    .hint-expl:empty { display: none; }

    /* ── OPTIONS LIST ── */
    .options-list {
      display: flex;
      flex-direction: column;
      gap: 7px;
      margin-bottom: 12px;
    }
    .opt-btn {
      display: flex;
      align-items: center;
      gap: 12px;
      width: 100%;
      background: #fff;
      border: 1.5px solid var(--border);
      border-radius: 12px;
      padding: 13px 16px;
      font-size: 14px;
      color: var(--text-1);
      cursor: pointer;
      transition: all 0.15s;
      text-align: left;
      min-height: 52px;
    }
    .opt-btn:hover:not(:disabled) {
      background: rgba(14,165,233,0.04);
      border-color: rgba(14,165,233,0.28);
    }
    .opt-btn.correct { background: rgba(22,163,74,0.07);  border-color: var(--success); color: var(--success); }
    .opt-btn.wrong   { background: rgba(220,38,38,0.06);  border-color: var(--error);   color: var(--error); }
    .opt-num {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 30px; height: 30px;
      border-radius: 50%;
      font-size: 13px;
      font-weight: 700;
      background: rgba(0,0,0,0.06);
      color: var(--text-2);
      flex-shrink: 0;
      transition: all 0.15s;
    }
    .opt-btn.correct .opt-num { background: var(--success); color: #fff; }
    .opt-btn.wrong   .opt-num { background: var(--error);   color: #fff; }
    .opt-text { flex: 1; line-height: 1.5; font-weight: 600; }
    @keyframes anim-pop   { 0% { transform: scale(1); } 40% { transform: scale(1.04); } 100% { transform: scale(1); } }
    @keyframes anim-shake { 0%, 100% { transform: translateX(0); } 20%, 60% { transform: translateX(-5px); } 40%, 80% { transform: translateX(5px); } }
    .opt-btn.anim-pop   { animation: anim-pop   0.3s ease-out; }
    .opt-btn.anim-shake { animation: anim-shake 0.4s ease-out; }

    /* ── EXPLANATION ── */
    .explanation {
      display: none;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 14px 16px;
      margin-bottom: 10px;
    }
    .explanation.show { display: block; }
    .expl-verdict     { font-size: 14px; font-weight: 800; margin-bottom: 6px; }
    .expl-verdict.ok  { color: var(--success); }
    .expl-verdict.ng  { color: var(--error); }
    .expl-text    { font-size: 13px; color: var(--text-2); line-height: 1.65; margin-bottom: 8px; }
    .key-phrases  { font-size: 12px; color: var(--text-2); line-height: 1.65; padding-top: 8px; border-top: 1px solid var(--border); display: flex; flex-wrap: wrap; gap: 6px; }
    .key-phrases:empty { display: none; padding: 0; border: none; }
    .kp { display: inline-block; background: rgba(14,165,233,0.08); border: 1px solid rgba(14,165,233,0.2); border-radius: 20px; padding: 2px 10px; font-size: 12px; font-weight: 600; color: var(--teal); }

    /* ── AXIS FEEDBACK PANEL ── */
    .axis-feedback { display: none; background: var(--surface); border: 1px solid var(--border); border-radius: 12px; padding: 12px 14px; margin-bottom: 10px; }
    .axis-feedback.show { display: block; }
    .af-header { display: flex; align-items: center; gap: 8px; margin-bottom: 10px; }
    .af-header-label { font-size: 11px; font-weight: 700; color: var(--text-3); letter-spacing: 0.5px; text-transform: uppercase; }
    .af-badge { font-size: 11px; font-weight: 700; background: rgba(245,166,35,0.12); color: var(--gold); border: 1px solid rgba(245,166,35,0.25); border-radius: 20px; padding: 2px 10px; }
    .af-rows { display: flex; flex-direction: column; gap: 7px; margin-bottom: 4px; }
    .af-row { display: flex; align-items: center; gap: 8px; border-radius: 6px; padding: 2px 4px; margin: 0 -4px; }
    .af-row-current { background: rgba(245,166,35,0.06); }
    .af-name { font-size: 12px; color: var(--text-2); width: 90px; flex-shrink: 0; }
    .af-bar-wrap { flex: 1; background: var(--border); border-radius: 4px; height: 5px; overflow: hidden; }
    .af-bar { height: 100%; border-radius: 4px; background: var(--gold); transition: width 0.7s ease; }
    .af-bar.weak { background: #ef4444; }
    .af-bar.strong { background: #22c55e; }
    .af-pct { font-size: 11px; color: var(--text-3); width: 28px; text-align: right; flex-shrink: 0; }
    .af-current-tag { font-size: 10px; font-weight: 700; color: var(--gold); flex-shrink: 0; margin-left: 2px; }
    .af-tip { font-size: 12px; color: var(--text-2); line-height: 1.6; margin-top: 8px; padding-top: 8px; border-top: 1px solid var(--border); }
    .af-tip:empty { display: none; }

    /* ── TRANSCRIPT ── */
    .transcript-toggle {
      display: none;
      background: none;
      border: none;
      color: var(--teal);
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      padding: 6px 0;
      margin-bottom: 4px;
      transition: opacity 0.15s;
    }
    .transcript-toggle.show { display: block; }
    .transcript-toggle:hover { opacity: 0.72; }
    .transcript {
      display: none;
      background: rgba(14,165,233,0.04);
      border: 1px solid rgba(14,165,233,0.12);
      border-radius: 12px;
      padding: 14px 16px;
      margin-bottom: 10px;
    }
    .transcript.show { display: block; }
    .transcript-label    { font-size: 10px; font-weight: 700; letter-spacing: 1.2px; text-transform: uppercase; color: var(--teal); margin-bottom: 6px; }
    .transcript-text     { font-size: 13px; color: var(--text-1); line-height: 1.8; margin-bottom: 10px; }
    .transcript-ja-label { font-size: 10px; font-weight: 700; letter-spacing: 1.2px; text-transform: uppercase; color: var(--text-3); margin-bottom: 4px; }
    .transcript-ja       { font-size: 13px; color: var(--text-2); line-height: 1.7; }

    /* ── NEXT BUTTON ── */
    .next-btn {
      display: none;
      width: 100%;
      background: linear-gradient(135deg, #E09520 0%, #F5A623 100%);
      color: #1a0800;
      font-weight: 800;
      font-size: 15px;
      border: none;
      border-radius: 14px;
      padding: 14px;
      cursor: pointer;
      transition: all 0.18s;
      box-shadow: 0 4px 18px rgba(245,166,35,0.22);
      margin-top: 8px;
      min-height: 52px;
    }
    .next-btn.show { display: block; }
    .next-btn:hover { filter: brightness(1.05); transform: translateY(-1px); box-shadow: 0 6px 24px rgba(245,166,35,0.38); }
    .next-btn:active { transform: translateY(0); }

    /* ── RESPONSIVE: SHORT SCREEN (iPhone SE etc.) max-height: 700px ── */
    @media (max-height: 700px) {
      .app-header   { height: 48px; }
      .audio-label  { margin-bottom: 6px; }
      .waveform     { height: 28px; margin-bottom: 6px; }
      .options-list { gap: 4px; }
      .opt-btn      { padding: 10px 14px; }
      .opt-num      { width: 28px; height: 28px; font-size: 13px; }
      .quiz-meta    { margin-bottom: 8px; }
      .audio-card   { margin-bottom: 8px; }
      .next-btn     { margin-top: 6px; padding: 12px; }
    }

    /* ── RESPONSIVE: TABLET 640px+ ── */
    @media (min-width: 640px) {
      .content      { max-width: 640px; padding: 24px 24px 40px; }
      .diff-card    { padding: 20px 22px; }
      .diff-icon    { font-size: 32px; width: 50px; }
      .diff-name    { font-size: 16px; }
      .diff-sub     { font-size: 13px; }
      .diff-pill    { padding: 7px 15px; font-size: 13px; }
      .quiz-meta    { margin-bottom: 18px; }
      .audio-card   { padding: 24px 28px 20px; border-radius: 20px; margin-bottom: 16px; }
      .waveform     { height: 48px; gap: 6px; margin-bottom: 14px; }
      .bar          { width: 5px; }
      .play-btn     { padding: 13px 28px; font-size: 15px; }
      .question-label { font-size: 15px; }
      .options-list { gap: 8px; }
      .opt-btn      { padding: 15px 18px; font-size: 15px; }
      .opt-num      { width: 34px; height: 34px; font-size: 14px; }
      .explanation  { padding: 18px 20px; border-radius: 16px; }
      .expl-verdict { font-size: 15px; }
      .expl-text    { font-size: 14px; }
      .next-btn     { padding: 16px; font-size: 16px; border-radius: 16px; margin-top: 12px; }
    }

    /* ── RESPONSIVE: DESKTOP 1024px+ ── */
    @media (min-width: 1024px) {
      .content      { max-width: 960px; padding: 40px 48px 64px; }
      .diff-card    { padding: 22px 26px; }
      .diff-icon    { font-size: 36px; width: 54px; }
      .audio-card   { padding: 36px 32px 28px; border-radius: 24px; margin-bottom: 0; }
      .audio-label  { margin-bottom: 16px; }
      .waveform     { height: 60px; gap: 7px; margin-bottom: 16px; }
      .bar          { width: 6px; }
      .play-btn     { padding: 15px 36px; font-size: 16px; }
      .options-list { gap: 10px; margin-bottom: 16px; }
      .opt-btn      { padding: 16px 20px; font-size: 16px; border-radius: 14px; }
      .opt-num      { width: 36px; height: 36px; font-size: 15px; }
      .next-btn     { padding: 18px; font-size: 17px; border-radius: 16px; margin-top: 12px; }
      .explanation  { padding: 20px 24px; border-radius: 18px; }
      .question-view.show {
        display: flex; flex-direction: row; gap: 40px; align-items: start;
      }
      .quiz-left  { flex: 0 0 40%; position: sticky; top: 72px; }
      .quiz-right { flex: 1; min-width: 0; }
    }

  /* ── EMAIL GATE MODAL ── */
  .eg-overlay{position:fixed;inset:0;background:rgba(0,0,0,.78);backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px);z-index:10000;display:flex;align-items:center;justify-content:center;padding:20px;animation:egFadeIn .25s ease;}
  @keyframes egFadeIn{from{opacity:0}to{opacity:1}}
  .eg-card{position:relative;overflow:hidden;background:#FFFFFF;border:1px solid rgba(0,0,0,0.1);border-radius:24px;padding:40px 32px 32px;max-width:420px;width:100%;box-shadow:0 8px 40px rgba(0,0,0,0.12);animation:egSlideUp .38s cubic-bezier(.16,1,.3,1);}
  @keyframes egSlideUp{from{transform:translateY(28px);opacity:0}to{transform:translateY(0);opacity:1}}
  .eg-orb-1{display:none;position:absolute;width:260px;height:260px;background:radial-gradient(circle,rgba(245,166,35,.14),transparent 70%);top:-80px;right:-60px;border-radius:50%;pointer-events:none;filter:blur(40px);}
  .eg-orb-2{display:none;position:absolute;width:180px;height:180px;background:radial-gradient(circle,rgba(59,91,219,.22),transparent 70%);bottom:-50px;left:-30px;border-radius:50%;pointer-events:none;filter:blur(40px);}
  .eg-body{position:relative;z-index:1;text-align:center;}
  .eg-emoji{font-size:3rem;margin-bottom:10px;}
  .eg-title{font-size:1.75rem;font-weight:900;color:rgba(0,0,0,.88);margin-bottom:6px;}
  .eg-sub{font-size:.95rem;color:rgba(0,0,0,.68);margin-bottom:6px;}
  .eg-gold{color:#F5A623;font-weight:700;}
  .eg-desc{font-size:.83rem;color:rgba(0,0,0,.60);line-height:1.75;margin-bottom:18px;}
  .eg-stats{background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:11px 16px;margin-bottom:22px;font-size:.85rem;color:rgba(0,0,0,.68);}
  .eg-form{display:flex;flex-direction:column;gap:10px;}
  .eg-input{width:100%;background:rgba(0,0,0,.04);border:1px solid rgba(0,0,0,.15);border-radius:12px;padding:14px 18px;color:rgba(0,0,0,.88);font-size:1rem;outline:none;transition:border-color .18s;}
  .eg-input:focus{border-color:rgba(245,166,35,.55);}
  .eg-input::placeholder{color:rgba(0,0,0,.32);}
  .eg-submit{width:100%;background:linear-gradient(135deg,#E09520,#F5A623);color:#1a1000;font-weight:800;font-size:1rem;padding:15px;border:none;border-radius:12px;cursor:pointer;box-shadow:0 4px 20px rgba(245,166,35,.35);transition:transform .18s,box-shadow .18s;min-height:48px;}
  .eg-submit:hover{transform:translateY(-2px);box-shadow:0 8px 30px rgba(245,166,35,.5);}
  .eg-submit:disabled{opacity:.6;cursor:not-allowed;transform:none;}
  .eg-consent{font-size:.76rem;color:rgba(0,0,0,.58);line-height:1.65;margin-top:10px;text-align:center;}
  .eg-consent a{color:rgba(0,0,0,.68);text-decoration:underline;}
  .eg-consent a:hover{color:rgba(0,0,0,.82);}
  .eg-error{color:var(--error);font-size:.78rem;margin-top:6px;display:none;}
  .eg-skip{background:none;border:none;color:rgba(0,0,0,.50);font-size:.78rem;cursor:pointer;margin-top:14px;text-decoration:underline;transition:color .18s;display:block;width:100%;}
  .eg-skip:hover{color:rgba(0,0,0,.70);}
.eg-field-group{margin-bottom:12px;text-align:left;}
.eg-field-label{font-size:.78rem;font-weight:700;color:rgba(0,0,0,.62);margin-bottom:6px;}
.eg-radio-row{display:flex;flex-wrap:wrap;gap:6px;}
.eg-radio-btn{cursor:pointer;}
.eg-radio-btn input{display:none;}
.eg-radio-btn span{display:inline-block;padding:5px 10px;border:1px solid rgba(0,0,0,.18);border-radius:20px;font-size:.78rem;font-weight:600;color:rgba(0,0,0,.62);transition:all .15s;}
.eg-radio-btn input:checked+span{background:rgba(245,166,35,.15);border-color:#F5A623;color:#000;}
.eg-radio-btn:hover span{border-color:rgba(245,166,35,.5);}
.eg-select{width:100%;background:rgba(0,0,0,.04);border:1px solid rgba(0,0,0,.15);border-radius:12px;padding:12px 16px;font-size:.88rem;color:rgba(0,0,0,.75);outline:none;transition:border-color .18s;cursor:pointer;-webkit-appearance:none;}
.eg-select:focus{border-color:rgba(245,166,35,.55);}
  @media(max-width:480px){.eg-card{padding:28px 20px 24px;}.eg-title{font-size:1.45rem;}}

/* ── SCROLL REVEAL ── */
.reveal {
  opacity: 0;
  transform: translateY(36px);
  transition: opacity 0.75s cubic-bezier(0.16,1,0.3,1), transform 0.75s cubic-bezier(0.16,1,0.3,1);
}
.reveal.visible {
  opacity: 1;
  transform: translateY(0);
}
.reveal-delay-1 { transition-delay: 0.08s; }
.reveal-delay-2 { transition-delay: 0.18s; }
.reveal-delay-3 { transition-delay: 0.28s; }

/* ── CURSOR SPOTLIGHT ── */
#cursorSpot {
  position: fixed;
  width: 480px; height: 480px;
  border-radius: 50%;
  pointer-events: none;
  z-index: 0;
  background: radial-gradient(circle at center, rgba(245,166,35,0.07) 0%, transparent 70%);
  transform: translate(-50%, -50%);
  transition: left 0.06s linear, top 0.06s linear, opacity 0.4s;
  opacity: 0;
}

/* ── HERO WAVEFORM DECORATION ── */
.hero-wave-deco {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 5px;
  height: 48px;
  margin: 28px auto 32px;
  animation: fadeUp 0.6s 0.35s ease-out both;
}
.hero-wave-deco .hwb {
  width: 4px;
  border-radius: 2px;
  background: var(--gold);
  opacity: 0.55;
  animation: hero-wave-anim 1.8s ease-in-out infinite;
}
.hero-wave-deco .hwb:nth-child(1)  { height: 12px; animation-delay: 0.00s; }
.hero-wave-deco .hwb:nth-child(2)  { height: 20px; animation-delay: 0.12s; }
.hero-wave-deco .hwb:nth-child(3)  { height: 32px; animation-delay: 0.22s; }
.hero-wave-deco .hwb:nth-child(4)  { height: 44px; animation-delay: 0.08s; }
.hero-wave-deco .hwb:nth-child(5)  { height: 36px; animation-delay: 0.18s; }
.hero-wave-deco .hwb:nth-child(6)  { height: 48px; animation-delay: 0.30s; }
.hero-wave-deco .hwb:nth-child(7)  { height: 40px; animation-delay: 0.10s; }
.hero-wave-deco .hwb:nth-child(8)  { height: 48px; animation-delay: 0.20s; }
.hero-wave-deco .hwb:nth-child(9)  { height: 36px; animation-delay: 0.05s; }
.hero-wave-deco .hwb:nth-child(10) { height: 24px; animation-delay: 0.25s; }
.hero-wave-deco .hwb:nth-child(11) { height: 14px; animation-delay: 0.15s; }
@keyframes hero-wave-anim {
  0%, 100% { transform: scaleY(0.3); opacity: 0.3; }
  50%       { transform: scaleY(1);   opacity: 0.8; }
}

/* ── STEP CARD ENHANCED HOVER ── */
.step-card:hover {
  border-color: rgba(245,166,35,0.45) !important;
  box-shadow: 0 12px 48px rgba(245,166,35,0.12), 0 0 0 1px rgba(245,166,35,0.2) !important;
  transform: translateY(-6px) !important;
}

/* ── PRICING CARD ENHANCED HOVER ── */
.pricing-card:hover {
  transform: translateY(-4px);
  box-shadow: 0 16px 48px rgba(0,0,0,0.08);
  transition: transform 0.28s ease, box-shadow 0.28s ease;
}

/* ── FEATURE ITEM HOVER ── */
.feature-item {
  transition: background 0.22s ease;
  cursor: default;
}
.feature-item:hover {
  background: rgba(245,166,35,0.04);
}

/* ── FLOATING BLOBS (additional) ── */
.orb-4 {
  width: 350px; height: 350px;
  background: radial-gradient(circle at center, rgba(245,166,35,0.06), transparent 70%);
  top: 60%; right: 5%;
  animation: float2 28s ease-in-out infinite reverse;
}
    /* ── HERO MOCKUP CARD ── */
    .hero-mockup {
      margin: 32px auto 0;
      max-width: 420px;
      background: #fff;
      border: 1px solid rgba(0,0,0,0.10);
      border-radius: 20px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.10), 0 4px 16px rgba(0,0,0,0.06);
      overflow: hidden;
      animation: fadeUp 0.6s 0.4s ease-out both;
      text-align: left;
    }
    .hm-header {
      background: #F7F8FA;
      border-bottom: 1px solid rgba(0,0,0,0.07);
      padding: 10px 16px;
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 11px;
      font-weight: 700;
      color: rgba(0,0,0,0.4);
      letter-spacing: 0.5px;
    }
    .hm-dot { width: 8px; height: 8px; border-radius: 50%; }
    .hm-dot-r { background: #FC5F5A; }
    .hm-dot-y { background: #FDBC40; }
    .hm-dot-g { background: #34C749; }
    .hm-body { padding: 16px 18px 18px; }
    .hm-audio {
      background: rgba(14,165,233,0.06);
      border: 1px solid rgba(14,165,233,0.15);
      border-radius: 12px;
      padding: 12px 14px;
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 14px;
    }
    .hm-play {
      width: 36px; height: 36px;
      border-radius: 50%;
      background: var(--teal);
      display: flex; align-items: center; justify-content: center;
      flex-shrink: 0;
      color: #fff;
      font-size: 13px;
    }
    .hm-wave {
      display: flex; align-items: center; gap: 3px; flex: 1;
    }
    .hm-wbar {
      width: 3px; border-radius: 2px;
      background: var(--teal);
      opacity: 0.6;
      animation: hm-wave-anim 1.6s ease-in-out infinite;
    }
    .hm-wbar:nth-child(1)  { height: 8px;  animation-delay: 0.00s; }
    .hm-wbar:nth-child(2)  { height: 16px; animation-delay: 0.10s; }
    .hm-wbar:nth-child(3)  { height: 24px; animation-delay: 0.20s; }
    .hm-wbar:nth-child(4)  { height: 18px; animation-delay: 0.08s; }
    .hm-wbar:nth-child(5)  { height: 28px; animation-delay: 0.18s; }
    .hm-wbar:nth-child(6)  { height: 22px; animation-delay: 0.28s; }
    .hm-wbar:nth-child(7)  { height: 14px; animation-delay: 0.12s; }
    .hm-wbar:nth-child(8)  { height: 20px; animation-delay: 0.22s; }
    .hm-wbar:nth-child(9)  { height: 10px; animation-delay: 0.06s; }
    @keyframes hm-wave-anim {
      0%, 100% { transform: scaleY(0.4); opacity: 0.35; }
      50%       { transform: scaleY(1);   opacity: 0.75; }
    }
    .hm-audio-label { font-size: 11px; color: var(--teal); font-weight: 700; }
    .hm-q { font-size: 13px; font-weight: 700; color: rgba(0,0,0,0.78); margin-bottom: 10px; }
    .hm-opts { display: flex; flex-direction: column; gap: 6px; }
    .hm-opt {
      font-size: 12px;
      padding: 8px 12px;
      border-radius: 8px;
      border: 1px solid rgba(0,0,0,0.09);
      color: rgba(0,0,0,0.55);
      background: rgba(0,0,0,0.02);
    }
    .hm-opt-active {
      border-color: var(--teal);
      background: rgba(14,165,233,0.08);
      color: var(--teal);
      font-weight: 700;
    }

    /* ── LP STICKY NAV ── */
    .lp-nav {
      position: fixed;
      top: 0; left: 0; right: 0;
      z-index: 200;
      background: rgba(255,255,255,0);
      backdrop-filter: blur(0px);
      -webkit-backdrop-filter: blur(0px);
      border-bottom: 1px solid transparent;
      transform: translateY(-100%);
      transition: transform 0.35s cubic-bezier(0.16,1,0.3,1),
                  background 0.3s, border-color 0.3s;
    }
    .lp-nav.visible {
      transform: translateY(0);
      background: rgba(255,255,255,0.92);
      backdrop-filter: blur(24px);
      -webkit-backdrop-filter: blur(24px);
      border-bottom-color: var(--border);
    }
    .lp-nav-inner {
      max-width: 900px; margin: 0 auto;
      padding: 0 20px; height: 56px;
      display: flex; align-items: center; justify-content: space-between;
    }
    .lp-nav-logo {
      display: flex; align-items: center; gap: 10px;
      font-size: 18px; font-weight: 800; letter-spacing: -0.5px;
      color: var(--text-1);
      text-decoration: none;
    }
    .lp-nav-logo svg { width: 24px; height: 24px; color: var(--gold); }
    .lp-nav-right { display: flex; align-items: center; gap: 20px; }
    .lp-nav-link {
      font-size: 13px; font-weight: 600;
      color: var(--text-2); text-decoration: none;
      transition: color var(--t);
    }
    .lp-nav-link:hover { color: var(--text-1); }
    .lp-nav-cta {
      background: linear-gradient(135deg, #E09520 0%, #F5A623 50%, #F8C347 100%);
      color: #000; font-size: 13px; font-weight: 800;
      border: none; border-radius: 50px;
      padding: 10px 20px; cursor: pointer;
      box-shadow: 0 2px 14px rgba(245,166,35,0.28);
      transition: all var(--t);
      white-space: nowrap;
    }
    .lp-nav-cta:hover {
      filter: brightness(1.06);
      box-shadow: 0 4px 22px rgba(245,166,35,0.45);
      transform: translateY(-1px);
    }
    @media (max-width: 480px) {
      .lp-nav-link { display: none; }
    }

    /* ── STATS STRIP ── */
    .stats-strip {
      display: flex;
      align-items: stretch;
      justify-content: center;
      gap: 0;
      padding: 48px 20px;
      max-width: 700px;
      margin: 0 auto;
    }
    .stat-item {
      flex: 1;
      text-align: center;
      padding: 0 20px;
    }
    .stat-divider {
      width: 1px;
      background: var(--border);
      align-self: stretch;
      margin: 8px 0;
    }
    .stat-num {
      font-size: clamp(36px, 6vw, 52px);
      font-weight: 900;
      letter-spacing: -2px;
      line-height: 1;
      margin-bottom: 6px;
      background: linear-gradient(135deg, var(--gold) 0%, #F8C347 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    .stat-label {
      font-size: 14px;
      font-weight: 600;
      color: var(--text-2);
      letter-spacing: 0.02em;
      margin-top: 4px;
    }
    .stat-unit {
      font-size: 20px;
      font-weight: 900;
      letter-spacing: -1px;
    }
    @media (max-width: 500px) {
      .stats-strip { gap: 0; }
      .stat-item { padding: 0 12px; }
      .stat-num { font-size: clamp(28px, 8vw, 40px); }
    }
  </style>
</head>
<body>
  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PS9R9844"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) -->

<!-- LP Sticky Nav -->
<nav class="lp-nav" id="lpNav">
  <div class="lp-nav-inner">
    <a class="lp-nav-logo" href="/listening/">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 18v-6a9 9 0 0 1 18 0v6"/><path d="M21 19a2 2 0 0 1-2 2h-1a2 2 0 0 1-2-2v-3a2 2 0 0 1 2-2h3zM3 19a2 2 0 0 0 2 2h1a2 2 0 0 0 2-2v-3a2 2 0 0 0-2-2H3z"/></svg>
      ListenUp
    </a>
    <div class="lp-nav-right">
      <button class="lp-nav-cta" onclick="beginQuiz()">今日の練習を始める</button>
    </div>
  </div>
</nav>

<!-- Background Orbs -->
<div class="orb orb-1"></div>
<div class="orb orb-2"></div>
<div class="orb orb-3"></div>
    <div class="orb orb-4"></div>
<div id="cursorSpot"></div>


<!-- Quiz Header (hidden on start screen) -->
<header class="app-header" id="appHeader">
  <div class="header-logo">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 18v-6a9 9 0 0 1 18 0v6"/><path d="M21 19a2 2 0 0 1-2 2h-1a2 2 0 0 1-2-2v-3a2 2 0 0 1 2-2h3zM3 19a2 2 0 0 0 2 2h1a2 2 0 0 0 2-2v-3a2 2 0 0 0-2-2H3z"/></svg>
    ListenUp
  </div>
  <div class="header-right">
    <div class="streak-badge zero" id="streakBadge">🔥 <span id="streakVal">0</span></div>
    <div class="progress-wrap">
      <div class="score-wrap">
        <span class="score-num" id="scoreVal">0</span><span style="color:var(--text-3)"> / </span><span id="totalVal">0</span>
      </div>
      <div class="progress-track"><div class="progress-fill" id="progressFill"></div></div>
    </div>
    <button class="reset-btn" onclick="goToStart()">← TOP</button>
  </div>
</header>

<!-- ═══════════════ START SCREEN (Landing Page) ═══════════════ -->
<div class="screen active" id="startScreen">

  <!-- ── SECTION 1: Hero ── -->
  <section class="lp-hero">
    <div class="lp-hero-inner">
      <h1 class="hero-h1">2回目で、<br><span class="text-gold">わかった</span>。</h1>
      <p class="hero-sub">その瞬間が、英語耳をつくる。<br>5段階アダプティブ × <span class="js-total-q"></span> × 毎日5分。</p>
      <div class="returning-stats" id="returningStats">
        <div class="rs-item"><span id="rsTotalAnswered">—</span><small>累計回答</small></div>
        <div class="rs-divider"></div>
        <div class="rs-item"><span id="rsDailyStreak">—</span><small>連続学習</small></div>
        <div class="rs-divider"></div>
        <div class="rs-item"><span id="rsAccuracy">—</span><small>正解率</small></div>
      </div>
      <div class="streak-status-wrap" id="streakStatusWrap">
        <span id="streakStatusText" class="streak-status-text"></span>
      </div>
      <div class="weekly-cal-wrap" id="weeklyCalWrap">
        <div class="wk-item"><div class="wk-label">月</div><div class="wk-dot" id="wkd0"></div></div>
        <div class="wk-item"><div class="wk-label">火</div><div class="wk-dot" id="wkd1"></div></div>
        <div class="wk-item"><div class="wk-label">水</div><div class="wk-dot" id="wkd2"></div></div>
        <div class="wk-item"><div class="wk-label">木</div><div class="wk-dot" id="wkd3"></div></div>
        <div class="wk-item"><div class="wk-label">金</div><div class="wk-dot" id="wkd4"></div></div>
        <div class="wk-item"><div class="wk-label">土</div><div class="wk-dot" id="wkd5"></div></div>
        <div class="wk-item"><div class="wk-label">日</div><div class="wk-dot" id="wkd6"></div></div>
      </div>
      <div class="hero-mockup">
        <div class="hm-header">
          <div class="hm-dot hm-dot-r"></div>
          <div class="hm-dot hm-dot-y"></div>
          <div class="hm-dot hm-dot-g"></div>
          <span style="margin-left:4px">ListenUp — 英語リスニング</span>
        </div>
        <div class="hm-body">
          <div class="hm-audio">
            <div class="hm-play">▶</div>
            <div class="hm-wave">
              <div class="hm-wbar"></div>
              <div class="hm-wbar"></div>
              <div class="hm-wbar"></div>
              <div class="hm-wbar"></div>
              <div class="hm-wbar"></div>
              <div class="hm-wbar"></div>
              <div class="hm-wbar"></div>
              <div class="hm-wbar"></div>
              <div class="hm-wbar"></div>
            </div>
            <div class="hm-audio-label">再生中</div>
          </div>
          <div class="hm-q">この会話の場面は？</div>
          <div class="hm-opts">
            <div class="hm-opt">🛫 空港でのチェックイン</div>
            <div class="hm-opt hm-opt-active">🚉 駅での道案内</div>
            <div class="hm-opt">🍽️ レストランの予約</div>
            <div class="hm-opt">🏨 ホテルのフロント</div>
          </div>
        </div>
      </div>
      <div class="hero-ctas">
        <button class="btn-primary-lg" id="freeTrialBtn" onclick="beginQuiz()">今日の練習を始める</button>
      </div>
      <p class="hero-fine"><span class="js-total-q"></span>すべて無料 · メール登録で無制限</p>
    </div>
  </section>


  <!-- ── Feature Strip ── -->
  <div class="feature-strip reveal">
    <div class="feature-item reveal reveal-delay-1">
      <span class="feature-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 18v-6a9 9 0 0 1 18 0v6"/><path d="M21 19a2 2 0 0 1-2 2h-1a2 2 0 0 1-2-2v-3a2 2 0 0 1 2-2h3zM3 19a2 2 0 0 0 2 2h1a2 2 0 0 0 2-2v-3a2 2 0 0 0-2-2H3z"/></svg>
      </span>
      <div class="feature-text"><strong>AI生成音声</strong></div>
    </div>
    <div class="feature-item reveal reveal-delay-2">
      <span class="feature-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/><line x1="2" y1="20" x2="22" y2="20"/></svg>
      </span>
      <div class="feature-text"><strong>5段階レベル＋弱点分析</strong></div>
    </div>
    <div class="feature-item reveal reveal-delay-3">
      <span class="feature-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>
      </span>
      <div class="feature-text"><strong>即時フィードバック</strong></div>
    </div>
    <div class="feature-item reveal reveal-delay-3">
      <span class="feature-icon" style="background:rgba(245,166,35,0.08);border-color:rgba(245,166,35,0.16);color:var(--gold)">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 12 20 22 4 22 4 12"/><rect x="2" y="7" width="20" height="5"/><line x1="12" y1="22" x2="12" y2="7"/><path d="M12 7H7.5a2.5 2.5 0 0 1 0-5C11 2 12 7 12 7z"/><path d="M12 7h4.5a2.5 2.5 0 0 0 0-5C13 2 12 7 12 7z"/></svg>
      </span>
      <div class="feature-text"><strong><span class="js-total-q"></span> 完全無料</strong></div>
    </div>
  </div>

  <!-- ── STATS ── -->
  <div class="stats-strip reveal">
    <div class="stat-item">
      <div class="stat-num" id="statQ">0</div>
      <div class="stat-label">収録問題数</div>
    </div>
    <div class="stat-divider"></div>
    <div class="stat-item">
      <div class="stat-num" id="statV">0</div>
      <div class="stat-label">AI音声バリエーション</div>
    </div>
    <div class="stat-divider"></div>
    <div class="stat-item">
      <div class="stat-num" id="statL">0</div>
      <div class="stat-label">難易度レベル</div>
    </div>
  </div>

  <!-- ── PHILOSOPHY ── -->
  <section class="philosophy-section reveal">
    <div class="philosophy-wrap">

      <div class="philosophy-eyebrow">OUR PHILOSOPHY</div>

      <p class="philosophy-hook">
        「もう1回聴いたら、わかった」<br>その瞬間、あなたの耳は確実に育っています。
      </p>

      <p class="philosophy-desc">
        「1回で聴き取れないと、才能がないのかな」と思ったことがあるかもしれません。<br>でも、それは全く違います。
      </p>

      <p class="philosophy-question">
        本当に耳が育つのは、<em>何回目に聴いた瞬間</em>だと思いますか？
      </p>

      <div class="philosophy-divider"></div>

      <p class="philosophy-insight">
        答えは、<strong>2〜3回目</strong>です。1回で余裕に聴けるものは「すでに知っている音」。それを繰り返しても耳は成長しません。
      </p>

      <p class="philosophy-insight">
        2〜3回聴いてはじめて理解できたとき、その表現は初めて<strong>「自分の音」</strong>に変わります。この繰り返しが、リスニング力の正体です。
      </p>

      <blockquote class="philosophy-quote">
        <p>「簡単すぎても、難しすぎても、耳は育たない。2〜3回でわかる——その難しさが、黄金地帯。」</p>
      </blockquote>

      <div class="philosophy-conclusion">
        <p>ListenUpの<strong>5段階アダプティブシステム</strong>は、あなたの「黄金地帯」を常に探し続けます。どんな音が聴き取りにくいか、どんなパターンで間違えるか——練習するほど、あなたのことを知っていきます。</p>
        <p class="philosophy-tagline">その一歩手前を、一緒に歩きます。</p>
      </div>

    </div>
  </section>

  <!-- ── SECTION 3: How It Works ── -->
  <section class="lp-section reveal">
    <div class="lp-wrap">
      <div class="section-eyebrow">HOW IT WORKS</div>
      <h2 class="section-h2">3ステップで<span class="text-gold">耳が変わる</span></h2>
      <div class="steps-row">
        <div class="step-card reveal reveal-delay-1">
          <div class="step-no">01</div>
          <div class="step-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/><path d="M19.07 4.93a10 10 0 0 1 0 14.14"/><path d="M15.54 8.46a5 5 0 0 1 0 7.07"/></svg>
          </div>
          <h3>聴く</h3>
          <p>わからなければ、もう一度。何度聴いてもOK。</p>
        </div>
        <div class="step-connector">→</div>
        <div class="step-card reveal reveal-delay-2">
          <div class="step-no">02</div>
          <div class="step-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M9 11l3 3L22 4"/><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/></svg>
          </div>
          <h3>選ぶ</h3>
          <p>どんな場面か、5択で答える。</p>
        </div>
        <div class="step-connector">→</div>
        <div class="step-card reveal reveal-delay-3">
          <div class="step-no">03</div>
          <div class="step-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><line x1="9" y1="18" x2="15" y2="18"/><line x1="10" y1="22" x2="14" y2="22"/><path d="M15.09 14c.18-.98.65-1.74 1.41-2.5A4.65 4.65 0 0 0 18 8 6 6 0 0 0 6 8c0 1 .23 2.23 1.5 3.5A4.61 4.61 0 0 1 8.91 14"/></svg>
          </div>
          <h3>掴む</h3>
          <p>正解・不正解どちらでも、キーフレーズで「聴こえた理由」を掴む。続けるほど、あなたの苦手パターンに合わせた問題が増えていく。</p>
        </div>
      </div>
    </div>
  </section>

  <!-- ── SECTION 4: Pricing ── -->
  <!-- ── COMPARISON TABLE ── -->
  <div class="compare-section reveal">
    <div class="compare-inner">
      <div class="compare-lead">
        <div class="section-eyebrow">COMPARISON</div>
        <h2 class="section-h2">各アプリの特徴を比べてみてください</h2>
        <p>価格・学習形式・問題数・AI機能を並べました。自分に合ったスタイルで選んでください。</p>
      </div>
      <div class="compare-scroll">
        <table class="compare-table">
          <thead>
            <tr>
              <th style="text-align:left">項目</th>
              <th class="col-self">Native-real<br><small style="font-size:10px;font-weight:600">完全無料</small></th>
              <th>スタサプ<br><small style="font-size:10px;font-weight:400">ENGLISH</small></th>
              <th>Cake<br><small style="font-size:10px;font-weight:400">Plus</small></th>
              <th>シャドテン</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="col-label">月額（税込）</td>
              <td class="col-self"><span class="compare-price-self">¥0</span></td>
              <td>¥2,178〜</td>
              <td>¥1,500</td>
              <td>¥21,780</td>
            </tr>
            <tr>
              <td class="col-label">主な学習形式</td>
              <td class="col-self">リスニングクイズ</td>
              <td>動画レッスン＋クイズ＋スピーキング</td>
              <td>動画視聴＋復習クイズ</td>
              <td>シャドーイング録音＋添削</td>
            </tr>
            <tr>
              <td class="col-label">リスニングクイズ問題数</td>
              <td class="col-self" id="compareQCount"></td>
              <td>コース内（公式非公表）</td>
              <td>動画クリップ形式</td>
              <td>教材1,000本以上</td>
            </tr>
            <tr>
              <td class="col-label">パーソナライズ</td>
              <td class="col-self">弱点パターン分析・適応出題</td>
              <td>スピーキング評価AI</td>
              <td>AI発音チェック・AIチューター</td>
              <td>人間トレーナーによる添削</td>
            </tr>
          </tbody>
        </table>
        <p style="font-size:11px;color:var(--text-3);margin-top:10px;line-height:1.6">※ 価格・機能は2026年2月時点の各社公式サイト記載情報をもとにしています。変更される場合があります。各サービスの最新情報は公式サイトでご確認ください。</p>
      </div>
    </div>
  </div>

  <!-- ── SECTION 6: Bottom Email CTA ── -->
  <div class="lp-bottom-cta reveal">
    <div class="lp-bcta-wrap">
      <div class="lp-bcta-eyebrow">FREE · <span class="js-total-q"></span></div>
      <h2 class="lp-bcta-h">耳が変わる実感を、<br><span style="color:var(--gold)">今日の練習</span>で。</h2>
      <p class="lp-bcta-sub">メールを登録すれば<span class="js-total-q"></span>すべてを制限なく練習できます。</p>
      <form class="lp-bcta-form" id="lpEmailForm" novalidate>
        <input type="email" id="lpEmailInput" class="lp-bcta-input" placeholder="your@email.com" autocomplete="email" required>
        <div class="lp-bcta-field-group">
          <span class="lp-bcta-field-label">年代</span>
          <div class="lp-bcta-radio-row">
            <label class="lp-bcta-radio-btn"><input type="radio" name="lpAge" value="10代"><span>10代</span></label>
            <label class="lp-bcta-radio-btn"><input type="radio" name="lpAge" value="20代"><span>20代</span></label>
            <label class="lp-bcta-radio-btn"><input type="radio" name="lpAge" value="30代"><span>30代</span></label>
            <label class="lp-bcta-radio-btn"><input type="radio" name="lpAge" value="40代"><span>40代</span></label>
            <label class="lp-bcta-radio-btn"><input type="radio" name="lpAge" value="50代"><span>50代</span></label>
            <label class="lp-bcta-radio-btn"><input type="radio" name="lpAge" value="60代以上"><span>60代+</span></label>
          </div>
        </div>
        <div class="lp-bcta-field-group">
          <span class="lp-bcta-field-label">TOEICスコア</span>
          <select id="lpToeicScore" class="lp-bcta-select">
            <option value="">選択してください</option>
            <option value="〜499点">〜499点</option>
            <option value="500〜599点">500〜599点</option>
            <option value="600〜699点">600〜699点</option>
            <option value="700〜799点">700〜799点</option>
            <option value="800〜899点">800〜899点</option>
            <option value="900〜990点">900〜990点</option>
            <option value="未受験">未受験</option>
          </select>
        </div>
        <button type="submit" class="lp-bcta-submit" id="lpEmailSubmit">登録して練習を始める →</button>
        <p class="lp-bcta-error" id="lpEmailError" style="display:none;color:#ffb347;font-size:.85rem;margin-top:4px;text-align:center"></p>
        <p class="lp-bcta-consent">登録することで<a href="/privacy/">プライバシーポリシー</a>・<a href="/privacy/#third-party">第三者提供について</a>に同意したものとみなします</p>
      </form>
      <button class="lp-bcta-skip" onclick="beginQuiz()">先に5問だけ試す（登録は後でOK）</button>
    </div>
  </div>

  <!-- ── 英語学習コラム ── -->
  <div class="lp-articles reveal">
    <div class="lp-articles-inner">
      <div class="lp-articles-eyebrow">LEARNING COLUMN</div>
      <h2 class="lp-articles-h">リスニングと一緒に読みたい<span class="text-gold">英語学習コラム</span></h2>
      <div class="lp-articles-grid">
        <a class="lp-article-card" href="/articles/english-speaking-improvement/">
          <div class="lp-article-tag">SPEAKING</div>
          <div class="lp-article-title">スピーキングが伸びない3つの共通点と、今日からできる改善法</div>
        </a>
        <a class="lp-article-card" href="/articles/english-habit-guide/">
          <div class="lp-article-tag">習慣化</div>
          <div class="lp-article-title">社会人が英語を習慣化する方法【挫折しない7つのコツ】</div>
        </a>
        <a class="lp-article-card" href="/articles/english-pronunciation-correction/">
          <div class="lp-article-tag">発音</div>
          <div class="lp-article-title">英語の発音矯正におすすめの方法・サービス比較【2026年版】</div>
        </a>
        <a class="lp-article-card" href="/articles/online-eikaiwa-frequency-guide/">
          <div class="lp-article-tag">継続</div>
          <div class="lp-article-title">オンライン英会話は週何回受けると効果が出る？科学的根拠から解説</div>
        </a>
      </div>
    </div>
  </div>

  <div class="lp-footer">
    <div style="margin-bottom:8px">
      <a href="/privacy/" style="color:var(--text-3);text-decoration:none;margin:0 10px;font-size:12px;transition:color 0.18s" onmouseover="this.style.color='var(--text-2)'" onmouseout="this.style.color='var(--text-3)'">プライバシーポリシー</a>
      <a href="https://native-real.com/" style="color:var(--text-3);text-decoration:none;margin:0 10px;font-size:12px;transition:color 0.18s" onmouseover="this.style.color='var(--text-2)'" onmouseout="this.style.color='var(--text-3)'">英会話サービス比較</a>
      <a href="/prompts/" style="color:var(--text-3);text-decoration:none;margin:0 10px;font-size:12px;transition:color 0.18s" onmouseover="this.style.color='var(--text-2)'" onmouseout="this.style.color='var(--text-3)'">AIプロンプト集</a>
    </div>
    © 2026 ListenUp · 全問無料
  </div>

</div>

<!-- ═══════════════ QUIZ SCREEN ═══════════════ -->
<div class="screen" id="quizScreen">
  <div class="content">

    <!-- Question counter -->
    <div class="quiz-meta">
      <div class="q-counter" id="qCounter">—</div>
    </div>

    <!-- Loading -->
    <div class="loading-view" id="loadingView">
      <div class="spinner"></div>
      <div class="loading-text">問題を読み込み中...</div>
    </div>

    <!-- Question -->
    <div class="question-view" id="questionView">

      <div class="quiz-left">
        <div class="audio-card" id="audioCard">
          <div class="audio-label">英語音声</div>
          <div class="accent-badge" id="accentBadge"></div>
          <div class="waveform" id="waveform">
            <div class="bar"></div><div class="bar"></div><div class="bar"></div>
            <div class="bar"></div><div class="bar"></div><div class="bar"></div>
            <div class="bar"></div><div class="bar"></div><div class="bar"></div>
            <div class="bar"></div>
          </div>
          <button class="play-btn" id="playBtn" onclick="replay()">
            <span id="playIcon">▶</span>
            <span id="playLabel">もう一度聴く</span>
          </button>
        </div>
      </div>

      <div class="quiz-right">
        <div class="question-label">この会話はどんな状況でしょう？</div>
        <div class="hint-panel" id="hintPanel">
          <div class="hint-label">💡 ヒント</div>
          <div class="hint-kp" id="hintKP"></div>
          <div class="hint-expl" id="hintExpl"></div>
        </div>
        <div class="options-list" id="optList"></div>

        <div class="explanation" id="explEl">
          <div class="expl-verdict" id="explVerdict"></div>
          <div class="expl-text"   id="explText"></div>
          <div class="key-phrases" id="explKP"></div>
        </div>

        <div class="axis-feedback" id="axisFeedback">
          <div class="af-header">
            <span class="af-header-label">スキル</span>
            <span class="af-badge" id="afBadge"></span>
          </div>
          <div class="af-rows" id="afRows"></div>
          <div class="af-tip" id="afTip"></div>
        </div>

        <button class="transcript-toggle" id="transcriptToggle" onclick="toggleTranscript()">
          英文を確認する ▾
        </button>
        <div class="transcript" id="transcriptEl">
          <div class="transcript-label">Script</div>
          <div class="transcript-text" id="transcriptText"></div>
          <div class="transcript-ja-label" id="transcriptJaLabel">仮訳</div>
          <div class="transcript-ja" id="transcriptJa"></div>
        </div>

        <button class="next-btn" id="nextBtn" onclick="next()">次の問題 →</button>
      </div>

    </div>
  </div>
</div>

<!-- ═══════════════ MISSION COMPLETE MODAL ═══════════════ -->
<div class="mission-overlay" id="missionOverlay">
  <div class="mission-modal">
    <div class="mission-emoji">🎉</div>
    <h2 class="mission-title">今日のミッション完了！</h2>
    <div class="mission-streak" id="missionStreakLine">🔥 1日連続達成！</div>
    <div class="mission-score-wrap">
      <div class="mission-score-item">
        <span id="missionScore">—</span><small>問正解</small>
      </div>
      <div class="mission-score-divider"></div>
      <div class="mission-score-item">
        <span id="missionAccuracy">—</span><small>正解率</small>
      </div>
    </div>
    <div class="mission-week" id="missionWeek"></div>
    <div class="mission-axis-wrap" id="missionAxisWrap" style="display:none">
      <div class="mission-axis-label">あなたの弱点分析</div>
      <div class="mission-axis-rows" id="missionAxisRows"></div>
      <p class="mission-axis-msg" id="missionAxisMsg"></p>
    </div>
    <div class="mission-articles">
      <div class="mission-articles-label">📖 次に読む</div>
      <a class="mission-article-link" href="/articles/english-speaking-improvement/">スピーキングが伸びない3つの共通点と今日からできる改善法</a>
      <a class="mission-article-link" href="/articles/english-habit-guide/">社会人が英語を習慣化する方法【挫折しない7つのコツ】</a>
      <a class="mission-article-link" href="/articles/online-eikaiwa-frequency-guide/">英会話は週何回受けると効果が出る？科学的根拠から解説</a>
    </div>
    <button class="mission-btn-back" onclick="closeMissionComplete()">← TOPに戻る</button>
  </div>
</div>

<audio id="audioEl" preload="auto"></audio>
<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
<script src="firebase-config.js"></script>
<script src="questions.js"></script>
<script>
// ─────────────────────────────────────────
// FIREBASE（設定は firebase-config.js で定義）
// ─────────────────────────────────────────
firebase.initializeApp(firebaseConfig);
const db   = firebase.firestore();
const auth = firebase.auth();
let firebaseUid = null;

const EG_SIGNIN_EMAIL_KEY    = 'emailForSignIn';
const EG_PENDING_PROFILE_KEY = 'pendingProfile';

// 認証状態の監視（メール認証済みユーザーの復元 & 匿名ログイン）
auth.onAuthStateChanged(function(user) {
  if (user) {
    firebaseUid = user.uid;
    if (!user.isAnonymous && user.email) {
      // メール認証済み → 登録状態を復元（デバイスをまたいで機能）
      localStorage.setItem(EG_REG_KEY, user.email);
      // Firestore から SRS・進捗を非同期ロード（beginQuiz で await）
      _firestoreLoadPromise = loadFromFirestore();
    }
  } else {
    auth.signInAnonymously().catch(err => console.warn('[Firebase] anon auth error:', err));
  }
});

// メールリンクからの帰着を検出して認証完了
if (auth.isSignInWithEmailLink(window.location.href)) {
  let _signinEmail = localStorage.getItem(EG_SIGNIN_EMAIL_KEY);
  if (!_signinEmail) {
    _signinEmail = window.prompt('確認のためメールアドレスを入力してください');
  }
  if (_signinEmail) {
    auth.signInWithEmailLink(_signinEmail, window.location.href)
      .then(async function(result) {
        firebaseUid = result.user.uid;
        window.history.replaceState({}, document.title, '/listening/');
        localStorage.setItem(EG_REG_KEY, _signinEmail);
        localStorage.removeItem(EG_SIGNIN_EMAIL_KEY);
        const _pending = localStorage.getItem(EG_PENDING_PROFILE_KEY);
        if (_pending) {
          localStorage.setItem('listenup_profile', _pending);
          localStorage.removeItem(EG_PENDING_PROFILE_KEY);
        }
        saveUserToFirestore(_signinEmail);
        // onAuthStateChanged より先に beginQuiz() が呼ばれるため、
        // _firestoreLoadPromise を明示的にセットしてから beginQuiz() を呼ぶ
        _firestoreLoadPromise = loadFromFirestore();
        beginQuiz();
      })
      .catch(function(err) {
        console.warn('[Firebase] signInWithEmailLink error:', err);
      });
  }
}

async function loadFromFirestore() {
  if (!firebaseUid) return;
  try {
    const doc = await db.collection('users').doc(firebaseUid).get();
    if (!doc.exists) return;
    const data = doc.data();

    // srsItems: Firestore を正として localStorage に上書き
    if (data.srsItems && typeof data.srsItems === 'object') {
      srsItems = data.srsItems;
      saveSrs();
    }

    // progress: totalAnswered が多い方（Firestore or localStorage）を採用
    const local = loadProgress();
    if ((data.totalAnswered || 0) > (local.totalAnswered || 0)) {
      const merged = {
        ...local,
        totalAnswered: data.totalAnswered || 0,
        totalCorrect:  data.totalCorrect  || 0,
        axisStats:     data.axisStats     || local.axisStats || {},
      };
      saveProgress(merged);
      showReturningStats(); // 統計パネルを再描画
    }
  } catch (err) {
    console.warn('[Firebase] read error:', err);
  }
}

async function saveUserToFirestore(email) {
  if (!firebaseUid) return;
  const p = loadProgress();
  const axisStats = p.axisStats || {};
  // 弱点軸を事前計算（5問以上回答した軸のみ対象）
  const ranked = Object.entries(axisStats)
    .filter(([, s]) => s.a >= 5)
    .sort((a, b) => (a[1].c / a[1].a) - (b[1].c / b[1].a));
  const weakestAxis = ranked.length > 0 ? ranked[0][0] : null;
  const data = {
    uid:           firebaseUid,
    lastSeenAt:    firebase.firestore.FieldValue.serverTimestamp(),
    totalAnswered: p.totalAnswered || 0,
    totalCorrect:  p.totalCorrect  || 0,
    axisStats:     axisStats,
    weakestAxis:   weakestAxis,
    srsItems:      srsItems,
  };
  if (email) data.email = email;
  try {
    await db.collection('users').doc(firebaseUid).set(data, { merge: true });
  } catch (err) {
    console.warn('[Firebase] write error:', err);
  }
}

const NUMS = ['①', '②', '③', '④', '⑤'];

// 音声アクセント情報（問題番号 % 5 で対応）
const ACCENT_INFO = [
  { flag: '🇺🇸', label: 'US' },   // 1,6,11...
  { flag: '🇬🇧', label: 'UK' },   // 2,7,12...
  { flag: '🇺🇸', label: 'US' },   // 3,8,13...
  { flag: '🇦🇺', label: 'AU' },   // 4,9,14...
  { flag: '🇬🇧', label: 'UK' },   // 5,10,15...
];

const DIFF_META = {
  beginner:     { icon: '🌱', label: '初級',  rate: 0.82 },
  intermediate: { icon: '🌿', label: '中級',  rate: 0.90 },
  advanced:     { icon: '🌳', label: '上級',  rate: 1.00 },
};


// ─────────────────────────────────────────
// LOCAL STORAGE
// ─────────────────────────────────────────
const STORAGE_KEY = 'listenup_v1';

function getToday() {
  return new Date().toISOString().slice(0, 10);
}

function defaultProgress() {
  return {
    totalAnswered: 0, totalCorrect: 0, dailyStreak: 0, lastVisitDate: '',
    todayAnswered: 0, todayDate: '', todayCorrect: 0, visitDates: [],
    axisStats: { speed:{a:0,c:0}, reduction:{a:0,c:0}, vocab:{a:0,c:0}, context:{a:0,c:0}, distractor:{a:0,c:0} }
  };
}

function loadProgress() {
  try {
    const raw = localStorage.getItem(STORAGE_KEY);
    if (!raw) return defaultProgress();
    const parsed = JSON.parse(raw);
    if (!parsed.axisStats) parsed.axisStats = defaultProgress().axisStats; // 既存ユーザーの移行
    return parsed;
  } catch (e) {
    return defaultProgress();
  }
}

function saveProgress(p) {
  try { localStorage.setItem(STORAGE_KEY, JSON.stringify(p)); } catch (e) {}
}

function updateDailyStreakInProgress(p) {
  const today     = getToday();
  const yesterday = new Date(Date.now() - 86400000).toISOString().slice(0, 10);
  if (p.lastVisitDate === today) {
    // 今日すでに訪問済み: ストリーク変更なし
  } else if (p.lastVisitDate === yesterday) {
    p.dailyStreak++;
  } else if (!p.lastVisitDate) {
    p.dailyStreak = 1;
  } else {
    p.dailyStreak = 1; // 途切れた
  }
  p.lastVisitDate = today;
  if (p.todayDate !== today) {
    p.todayAnswered = 0;
    p.todayCorrect  = 0;
    p.todayDate     = today;
  }
  // visitDates に今日を追記（重複なし、直近90日分保持）
  if (!p.visitDates) p.visitDates = [];
  if (!p.visitDates.includes(today)) {
    p.visitDates.push(today);
    if (p.visitDates.length > 90) p.visitDates = p.visitDates.slice(-90);
  }
  return p;
}

function showReturningStats() {
  const p = loadProgress();
  if (p.totalAnswered === 0) return;

  const today          = getToday();
  const todayAnswered  = (p.todayDate === today) ? p.todayAnswered : 0;
  const acc            = p.totalAnswered > 0 ? Math.round(p.totalCorrect / p.totalAnswered * 100) : 0;
  const practicedToday = todayAnswered > 0;

  // 累計スタッツ
  document.getElementById('rsTotalAnswered').textContent = p.totalAnswered.toLocaleString();
  document.getElementById('rsDailyStreak').textContent   = p.dailyStreak + '日';
  document.getElementById('rsAccuracy').textContent      = acc + '%';
  document.getElementById('returningStats').style.display = 'flex';

  // ストリーク状態バナー
  if (p.dailyStreak >= 2) {
    const wrap = document.getElementById('streakStatusWrap');
    const text = document.getElementById('streakStatusText');
    wrap.style.display = 'flex';
    if (practicedToday) {
      wrap.className = 'streak-status-wrap done';
      text.textContent = `✅ 今日の練習完了！🔥 ${p.dailyStreak}日連続中`;
    } else {
      wrap.className = 'streak-status-wrap not-done';
      text.textContent = `🔥 ${p.dailyStreak}日連続中 — 今日も練習して記録を守ろう！`;
    }
  }

  // 週間カレンダー
  const weekData = getWeekData(p.visitDates || []);
  const hasHistory = weekData.some(d => d.done) || p.dailyStreak >= 1;
  if (hasHistory) {
    document.getElementById('weeklyCalWrap').style.display = 'flex';
    weekData.forEach((d, i) => {
      const dot = document.getElementById('wkd' + i);
      if (!dot) return;
      dot.className = 'wk-dot';
      if      (d.isFuture)                        dot.className += ' future';
      else if (d.isToday && practicedToday)        dot.className += ' today-done';
      else if (d.isToday)                          dot.className += ' today-pending';
      else if (d.done)                             dot.className += ' done';
    });
  }
}

// ─────────────────────────────────────────
// AXIS: ユーザー向けラベル・説明
// ─────────────────────────────────────────
const AXIS_USER_LABELS = {
  speed:      '早口・速い英語',
  reduction:  '崩れた発音',
  vocab:      '語彙・イディオム',
  context:    '場面の読み取り',
  distractor: '精聴力',
};
const AXIS_USER_MSGS = {
  speed:      '速い発話についていく練習を続けましょう。',
  reduction:  'gonna / wanna などの音変化に慣れましょう。',
  vocab:      'イディオムやスラングの知識を増やしましょう。',
  context:    '状況やトーンから意図を読む練習をしましょう。',
  distractor: '選択肢を最後まで正確に聴き比べる精度を磨きましょう。',
};

// ─────────────────────────────────────────
// STATE
// ─────────────────────────────────────────
const LEVELS = ['lv1', 'lv2', 'lv3', 'lv4', 'lv5'];
let currentLevel     = 2; // lv3 からスタート
let correctStreak    = 0;
let recoveryMode     = false; // リカバリー問題出題中フラグ
let postRecoveryLevel = -1;  // リカバリー正解後に戻るレベル
let playCount        = 0;    // 現在の問題の再生回数
let pools            = {};
let current   = null;
let score     = 0;
let total     = 0;
let streak    = 0;
let answered           = false;
let srsItems           = {}; // { "q042": { interval, reps, dueDate } }
let reviewQueue        = []; // 本日 due の SRS 問題（セッション開始時に確定）
let _firestoreLoadPromise = null; // Firestore 非同期読み込みの Promise（beginQuiz で await）
let isPlaying          = false;

// ─────────────────────────────────────────
// NAVIGATION
// ─────────────────────────────────────────
function scrollToDiff() {
  document.getElementById('diffSelectWrap').scrollIntoView({ behavior: 'smooth', block: 'center' });
}

function scrollToDiffAndUpgrade() {
  goToStart();
  setTimeout(() => scrollToDiff(), 150);
}

// ─────────────────────────────────────────
// START
// ─────────────────────────────────────────
async function beginQuiz() {
  // Firestore 読み込みを待機（最大2秒。未ログインや読み込み済みは即通過）
  if (_firestoreLoadPromise) {
    await Promise.race([
      _firestoreLoadPromise,
      new Promise(r => setTimeout(r, 3000))
    ]);
    _firestoreLoadPromise = null; // 2回目以降は即通過
  }

  // 連続学習ストリーク更新
  let p = loadProgress();
  p = updateDailyStreakInProgress(p);
  saveProgress(p);

  score = 0; total = 0; streak = 0;
  currentLevel = 2; correctStreak = 0;
  recoveryMode = false; postRecoveryLevel = -1; playCount = 0;
  srsItems = loadSrs(); // Firestore sync 済み or localStorage フォールバック
  initPools();
  document.getElementById('startScreen').classList.remove('active');
  document.getElementById('quizScreen').classList.add('active');
  document.getElementById('appHeader').style.display = 'flex';

  updateScore();
  loadQ();
}

function goToStart() {
  audioEl.pause();
  audioEl.currentTime = 0;
  document.getElementById('quizScreen').classList.remove('active');
  document.getElementById('startScreen').classList.add('active');
  document.getElementById('appHeader').style.display = 'none';
  window.scrollTo({ top: 0 });
  // GA4: セッション完了イベント
  if (total > 0) {
    try {
      const p = loadProgress();
      gtag('event', 'quiz_session_complete', {
        session_questions: total,
        session_correct: score,
        session_accuracy: total > 0 ? Math.round(score / total * 100) : 0,
        lifetime_questions: p.totalAnswered,
        daily_streak: p.dailyStreak
      });
    } catch(e) {}
  }
  showReturningStats();
}

// ─────────────────────────────────────────
// POOLS (Adaptive)
// ─────────────────────────────────────────
const MAX_REVIEWS_PER_SESSION = 5;

function initPools() {
  pools = {
    0: shuffle(DATA.filter(q => q.diff === 'lv1')),
    1: shuffle(DATA.filter(q => q.diff === 'lv2')),
    2: shuffle(DATA.filter(q => q.diff === 'lv3')),
    3: shuffle(DATA.filter(q => q.diff === 'lv4')),
    4: shuffle(DATA.filter(q => q.diff === 'lv5'))
  };

  // 本日 due の SRS 復習問題を最大5件キューに積む
  const today = getToday();
  const dueEntries = Object.entries(srsItems)
    .filter(([, v]) => v.dueDate <= today)
    .sort((a, b) => a[1].dueDate.localeCompare(b[1].dueDate)) // 古い順（より期限切れのものを優先）
    .slice(0, MAX_REVIEWS_PER_SESSION);

  const dueIdSet = new Set(dueEntries.map(([id]) => id));

  reviewQueue = dueEntries
    .map(([id]) => {
      const q = DATA.find(q => getSrsId(q) === id);
      return q ? { ...q, isReview: true } : null;
    })
    .filter(Boolean);

  // 通常プールから重複を除去（復習キューと被らないように）
  if (dueIdSet.size > 0) {
    for (let i = 0; i <= 4; i++) {
      pools[i] = pools[i].filter(q => !dueIdSet.has(getSrsId(q)));
    }
  }
}

// ─────────────────────────────────────────
// PICK QUESTION (axis-weighted selection)
// ─────────────────────────────────────────
function pickQuestion() {
  // ⓪ SRS 復習問題を最優先（Anki 方式：復習を先に消化してから新問題へ）
  if (reviewQueue.length > 0) return reviewQueue.shift();

  // プールが空なら再初期化
  if (!pools[currentLevel] || !pools[currentLevel].length) {
    pools[currentLevel] = shuffle(DATA.filter(q => q.diff === LEVELS[currentLevel]));
  }
  const pool = pools[currentLevel];

  // ① 先頭4問以内のリトライ問題を優先（難易度適応のリカバリーフローを壊さない）
  const retryIdx = pool.slice(0, 4).findIndex(q => q.isRetry);
  if (retryIdx !== -1) return pool.splice(retryIdx, 1)[0];

  // ② axis優先選択（累積20問以上でアクティベート、70%の確率で適用）
  const p = loadProgress();
  const axisStats = p.axisStats || {};
  const totalAttempts = Object.values(axisStats).reduce((sum, s) => sum + (s.a || 0), 0);

  if (totalAttempts >= 20 && Math.random() < 0.7) {
    const AXES = ['speed', 'reduction', 'vocab', 'context', 'distractor'];
    // 3回以上試みたaxisのみ対象（データ不足のaxisを除外）
    const withData = AXES.filter(ax => (axisStats[ax]?.a || 0) >= 3);
    if (withData.length >= 2) {
      const sorted = [...withData].sort((a, b) => {
        const rA = axisStats[a].c / axisStats[a].a;
        const rB = axisStats[b].c / axisStats[b].a;
        return rA - rB; // 正解率の低い順
      });
      const weakAxes = sorted.slice(0, 2); // 最も弱い2軸
      const idx = pool.findIndex(q => weakAxes.includes(q.axis));
      if (idx !== -1) return pool.splice(idx, 1)[0];
    }
  }

  // ③ 通常選択（フォールバック）
  return pool.shift();
}

// ─────────────────────────────────────────
// LOAD QUESTION
// ─────────────────────────────────────────
function loadQ() {
  answered = false;
  audioEl.pause();
  audioEl.currentTime = 0;

  document.getElementById('loadingView').classList.add('show');
  document.getElementById('questionView').classList.remove('show');
  document.getElementById('explEl').classList.remove('show');
  document.getElementById('axisFeedback').classList.remove('show');
  document.getElementById('transcriptToggle').classList.remove('show');
  document.getElementById('transcriptToggle').textContent = '英文を確認する ▾';
  document.getElementById('transcriptEl').classList.remove('show');
  document.getElementById('nextBtn').classList.remove('show');

  setTimeout(() => {
    current = pickQuestion();
    playCount = 0;
    render();
    document.getElementById('loadingView').classList.remove('show');
    document.getElementById('questionView').classList.add('show');
    // 自動再生なし — ▶ボタンで再生
  }, 400);
}

// ─────────────────────────────────────────
// RENDER
// ─────────────────────────────────────────
function render() {
  const qLabel = `${total + 1}問目`;
  document.getElementById('qCounter').textContent = qLabel;
  audioEl.src = '';
  setPlayBtn(false);
  document.getElementById('waveform').classList.remove('playing');
  document.getElementById('audioCard').classList.remove('is-playing');

  // アクセントバッジ / 復習バッジ
  const qNum = parseInt((current.audio || '').match(/q(\d+)\.mp3/)?.[1] || '1');
  const accent = ACCENT_INFO[(qNum - 1) % ACCENT_INFO.length];
  const accentBadge = document.getElementById('accentBadge');
  accentBadge.textContent = current.isReview
    ? `🔁 復習 · ${accent.flag} ${accent.label}`
    : `${accent.flag} ${accent.label}`;
  accentBadge.style.background = current.isReview ? 'rgba(245,166,35,0.18)' : '';

  // ヒントパネル
  const hintLevel = current.hintLevel || 0;
  const hintPanel = document.getElementById('hintPanel');
  const hintKP    = document.getElementById('hintKP');
  const hintExpl  = document.getElementById('hintExpl');
  hintKP.innerHTML = '';
  hintExpl.textContent = '';
  if (hintLevel >= 1 && (current.kp || []).length > 0) {
    appendKpSpans(hintKP, current.kp);
    if (hintLevel >= 2 && current.expl) {
      hintExpl.textContent = current.expl;
    }
    hintPanel.classList.add('show');
  } else {
    hintPanel.classList.remove('show');
  }

  // 選択肢をシャッフル（正解位置を毎回変える）
  const shuffled = [...current.choices].sort(() => Math.random() - 0.5);

  const list = document.getElementById('optList');
  list.innerHTML = '';
  shuffled.forEach((opt, i) => {
    const btn = document.createElement('button');
    btn.className = 'opt-btn';
    btn.innerHTML = `<div class="opt-num">${NUMS[i]}</div><div class="opt-text">${opt}</div>`;
    btn.addEventListener('click', () => choose(opt));
    list.appendChild(btn);
  });
}

// ─────────────────────────────────────────
// ANSWER
// ─────────────────────────────────────────
function choose(selected) {
  if (answered) return;
  answered = true;
  total++;
  const ok = selected === current.answer;
  if (ok) {
    score++; streak++;
    if (recoveryMode) {
      // リカバリー成功 → postRecoveryLevel から再開
      recoveryMode = false;
      currentLevel = postRecoveryLevel;
      correctStreak = 0;
    } else {
      correctStreak++;
      if (correctStreak >= 2 && currentLevel < 4) {
        currentLevel++;
        correctStreak = 0;
      }
    }
  } else {
    streak = 0;
    if (!recoveryMode) {
      // 通常問題を不正解 → リカバリーモード開始
      correctStreak = 0;
      const returnLevel = Math.max(0, currentLevel - 1);
      const recoveryLevel = Math.max(0, currentLevel - 2);
      // 不正解問題を returnLevel のプールに再挿入（ヒントレベルを上げる）
      const requeuedQ = { ...current, hintLevel: (current.hintLevel || 0) + 1, isRetry: true };
      if (!pools[returnLevel]) pools[returnLevel] = [];
      pools[returnLevel].splice(Math.min(3, pools[returnLevel].length), 0, requeuedQ);
      // リカバリーモードへ
      recoveryMode = true;
      postRecoveryLevel = returnLevel;
      currentLevel = recoveryLevel;
    } else {
      // リカバリー問題も不正解 → さらに1段階下がる
      const nextLevel = Math.max(0, currentLevel - 1);
      const requeuedQ = { ...current, hintLevel: (current.hintLevel || 0) + 1, isRetry: true };
      if (!pools[nextLevel]) pools[nextLevel] = [];
      pools[nextLevel].splice(Math.min(3, pools[nextLevel].length), 0, requeuedQ);
      postRecoveryLevel = Math.max(0, postRecoveryLevel - 1);
      currentLevel = nextLevel;
    }
  }
  // 進捗をlocalStorageに保存
  const p     = loadProgress();
  const today = getToday();
  p.totalAnswered++;
  if (ok) p.totalCorrect++;
  if (p.todayDate !== today) { p.todayAnswered = 0; p.todayCorrect = 0; p.todayDate = today; }
  p.todayAnswered++;
  if (ok) p.todayCorrect++;
  // axis 別正解率を記録
  const ax = current.axis;
  if (ax && p.axisStats && p.axisStats[ax]) {
    p.axisStats[ax].a++;
    if (ok) p.axisStats[ax].c++;
  }
  saveProgress(p);

  // SRS 更新（セッション内即再出題の isRetry は除外）
  const srsId = getSrsId(current);
  if (srsId && !current.isRetry) {
    const updated = updateSrsItem(srsItems[srsId], ok);
    if (updated.reps >= 5) {
      delete srsItems[srsId]; // 5回連続正解で卒業
    } else if (!ok || srsItems[srsId]) {
      srsItems[srsId] = updated; // 不正解 or 既存SRS問題は更新
    }
    saveSrs();
    scheduleSave();
  }

  updateScore();

  // GA4: クイズ回答イベント
  try {
    const _sessAcc = total > 0 ? Math.round(score / total * 100) : 0;
    const _lifeAcc = p.totalAnswered > 0 ? Math.round(p.totalCorrect / p.totalAnswered * 100) : 0;
    gtag('event', 'quiz_answer', {
      answer_correct: ok,
      question_number: total,
      difficulty: LEVELS[currentLevel],
      play_count: playCount,
      session_accuracy: _sessAcc,
      max_level_reached: LEVELS[currentLevel],
      lifetime_questions: p.totalAnswered,
      lifetime_accuracy: _lifeAcc,
      daily_streak: p.dailyStreak,
      is_registered: isRegistered() ? 'true' : 'false'
    });
  } catch(e) { /* gtag未定義の場合は無視 */ }

  document.querySelectorAll('.opt-btn').forEach((btn) => {
    btn.disabled = true;
    const text = btn.querySelector('.opt-text').textContent;
    if (text === current.answer) {
      btn.classList.add('correct', 'anim-pop');
      btn.addEventListener('animationend', () => btn.classList.remove('anim-pop'), { once: true });
    } else if (text === selected && !ok) {
      btn.classList.add('wrong', 'anim-shake');
      btn.addEventListener('animationend', () => btn.classList.remove('anim-shake'), { once: true });
    }
  });

  if (ok) launchConfetti();

  const el = document.getElementById('explEl');
  document.getElementById('explVerdict').className = 'expl-verdict ' + (ok ? 'ok' : 'ng');
  document.getElementById('explVerdict').textContent = ok ? '✅ 正解！' : '❌ 不正解... 🔁 あとで再出題します';
  document.getElementById('explText').textContent = current.expl || (ok ? '' : `正解：${current.answer}`);

  const kpEl = document.getElementById('explKP');
  kpEl.innerHTML = '';
  appendKpSpans(kpEl, current.kp);

  el.classList.add('show');
  showAxisFeedback(current.axis);

  // Transcript: always show after answering
  document.getElementById('transcriptText').textContent = current.text;
  const jaEl = document.getElementById('transcriptJa');
  const jaLabelEl = document.getElementById('transcriptJaLabel');
  jaEl.textContent = current.ja || '';
  jaLabelEl.style.display = current.ja ? '' : 'none';
  document.getElementById('transcriptEl').classList.add('show');
  document.getElementById('transcriptToggle').classList.remove('show');

  const nextBtn = document.getElementById('nextBtn');
  nextBtn.classList.add('show');

  // 次へボタンが見えるように自動スクロール
  setTimeout(() => {
    nextBtn.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
  }, 300);
}

// ─────────────────────────────────────────
// AXIS FEEDBACK PANEL（登録ユーザーのみ）
// ─────────────────────────────────────────
function showAxisFeedback(ax) {
  if (!isRegistered() || !ax) return;
  const panel  = document.getElementById('axisFeedback');
  const rowsEl = document.getElementById('afRows');
  const tipEl  = document.getElementById('afTip');

  document.getElementById('afBadge').textContent = AXIS_USER_LABELS[ax] || ax;
  rowsEl.innerHTML = '';
  tipEl.textContent = '';

  const p     = loadProgress();
  const stats = p.axisStats || {};
  const MIN   = 5;
  const AXES  = ['speed', 'reduction', 'vocab', 'context', 'distractor'];

  const withData = AXES.filter(a => (stats[a]?.a || 0) >= MIN);
  if (withData.length === 0) {
    tipEl.textContent = `各スキル${MIN}問以上で詳細な分析が表示されます`;
  } else {
    const sorted = [...withData].sort((a, b) =>
      ((stats[a].c || 0) / stats[a].a) - ((stats[b].c || 0) / stats[b].a)
    );
    sorted.forEach(a => {
      const pct    = Math.round((stats[a].c || 0) / stats[a].a * 100);
      const isCur  = a === ax;
      const barCls = pct < 50 ? 'weak' : pct >= 75 ? 'strong' : '';
      const row = document.createElement('div');
      row.className = 'af-row' + (isCur ? ' af-row-current' : '');
      row.innerHTML =
        `<span class="af-name">${AXIS_USER_LABELS[a]}</span>` +
        `<div class="af-bar-wrap"><div class="af-bar ${barCls}" style="width:${pct}%"></div></div>` +
        `<span class="af-pct">${pct}%</span>` +
        (isCur ? '<span class="af-current-tag">今</span>' : '');
      rowsEl.appendChild(row);
    });
    const weakest  = sorted[0];
    const weakRate = Math.round((stats[weakest].c || 0) / stats[weakest].a * 100);
    if (weakRate < 75) tipEl.textContent = AXIS_USER_MSGS[weakest] || '';
  }
  panel.classList.add('show');
}

// ─────────────────────────────────────────
// TRANSCRIPT
// ─────────────────────────────────────────
function toggleTranscript() {
  const el  = document.getElementById('transcriptEl');
  const btn = document.getElementById('transcriptToggle');
  const open = el.classList.toggle('show');
  btn.textContent = open ? '英文を閉じる ▴' : '英文を確認する ▾';
}

// ─────────────────────────────────────────
// EMAIL GATE
// ─────────────────────────────────────────
const EG_TRIGGER   = 5;
const EG_REG_KEY   = 'listenup_registered';
const EG_SKIP_KEY  = 'listenup_gate_skipped';
// Google フォームへの登録データ送信（fire-and-forget）
function submitRegistration(email, ageGroup, toeicScore) {
  const body = new URLSearchParams({
    'entry.4758104':    email,
    'entry.2109990350': ageGroup,
    'entry.778801164':  toeicScore
  });
  fetch('https://docs.google.com/forms/d/e/1FAIpQLSca5r79E7e18Z0gHb10RjkLoyPgf3ZmioxWpTQWQ8BksBPthw/formResponse', {
    method: 'POST', mode: 'no-cors',
    headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
    body: body.toString()
  }).catch(() => {});
}

function isRegistered() {
  return !!localStorage.getItem(EG_REG_KEY);
}

function showEmailGate() {
  const pct = total > 0 ? Math.round(score / total * 100) : 0;
  document.getElementById('egStats').textContent =
    `📊 正解率 ${score}/${total}問 (${pct}%) — ここまでよくできました！`;
  document.getElementById('egOverlay').style.display = 'flex';
  document.body.style.overflow = 'hidden';
  setTimeout(() => document.getElementById('egInput').focus(), 100);

  // GA4: メールゲート表示イベント
  try { gtag('event', 'email_gate_view', { questions_answered: total }); } catch(e) {}
}

function closeEmailGate(continuePlay) {
  document.getElementById('egOverlay').style.display = 'none';
  document.body.style.overflow = '';
  if (continuePlay) loadQ();
}


// ─────────────────────────────────────────
// NEXT
// ─────────────────────────────────────────
function next() {
  // メール登録ゲート（5問後・未登録）
  if (total >= EG_TRIGGER && !isRegistered()) {
    showEmailGate();
    return;
  }
  loadQ();
}

// ─────────────────────────────────────────
// SCORE
// ─────────────────────────────────────────
function updateScore() {
  const scoreEl = document.getElementById('scoreVal');
  scoreEl.textContent = score;
  scoreEl.classList.remove('bump');
  void scoreEl.offsetWidth;
  if (score > 0) scoreEl.classList.add('bump');

  document.getElementById('totalVal').textContent = total;
  const pct = total > 0 ? Math.round(score / total * 100) : 0;
  document.getElementById('progressFill').style.width = pct + '%';
  document.getElementById('streakVal').textContent = streak;
  document.getElementById('streakBadge').classList.toggle('zero', streak === 0);
}

// ─────────────────────────────────────────
// AUDIO PLAYBACK
// ─────────────────────────────────────────
const audioEl = document.getElementById('audioEl');

const AUDIO_BASE = window.location.pathname.startsWith('/listening') ? '/listening/' : '';

function stopPlayback() {
  isPlaying = false;
  setPlayBtn(false);
  document.getElementById('waveform').classList.remove('playing');
  document.getElementById('audioCard').classList.remove('is-playing');
}

function speak(audioPath) {
  audioEl.pause();
  audioEl.currentTime = 0;
  audioEl.src = AUDIO_BASE + audioPath;

  audioEl.onplay  = () => {
    isPlaying = true;
    setPlayBtn(true);
    document.getElementById('waveform').classList.add('playing');
    document.getElementById('audioCard').classList.add('is-playing');
  };
  audioEl.onended = stopPlayback;
  audioEl.onerror = stopPlayback;
  audioEl.play();
}

function replay() {
  if (!current) return;
  if (isPlaying) {
    audioEl.pause();
    audioEl.currentTime = 0;
    stopPlayback();
  } else {
    playCount++;
    speak(current.audio);
  }
}

function setPlayBtn(playing) {
  document.getElementById('playBtn').classList.toggle('playing', playing);
  document.getElementById('playIcon').textContent  = playing ? '⏸' : '▶';
  document.getElementById('playLabel').textContent = playing ? '再生中...' : (audioEl.src ? 'もう一度聴く' : '音声を聴く');
}

// ─────────────────────────────────────────
// CONFETTI
// ─────────────────────────────────────────
let confettiRaf = null;
function launchConfetti() {
  const canvas = document.getElementById('confettiCanvas');
  const ctx    = canvas.getContext('2d');
  canvas.width  = window.innerWidth;
  canvas.height = window.innerHeight;
  canvas.style.display = 'block';

  const COLORS = ['#FF6B6B','#FFE66D','#4ECDC4','#74C0FC','#A9E34B','#CC5DE8','#F08C00','#F783AC'];
  const particles = Array.from({ length: 100 }, () => ({
    x: Math.random() * canvas.width, y: -10 - Math.random() * 100,
    w: 5 + Math.random() * 9, h: 3 + Math.random() * 5,
    color: COLORS[Math.floor(Math.random() * COLORS.length)],
    vx: (Math.random() - 0.5) * 8, vy: 2 + Math.random() * 5,
    rot: Math.random() * 360, rotV: (Math.random() - 0.5) * 14, opacity: 1,
  }));

  if (confettiRaf) cancelAnimationFrame(confettiRaf);
  function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    let alive = false;
    for (const p of particles) {
      p.x += p.vx; p.y += p.vy; p.vy += 0.18;
      p.rot += p.rotV; p.opacity -= 0.013;
      if (p.opacity <= 0) continue;
      alive = true;
      ctx.save(); ctx.globalAlpha = Math.max(0, p.opacity);
      ctx.fillStyle = p.color; ctx.translate(p.x, p.y);
      ctx.rotate(p.rot * Math.PI / 180);
      ctx.fillRect(-p.w / 2, -p.h / 2, p.w, p.h);
      ctx.restore();
    }
    if (alive) confettiRaf = requestAnimationFrame(draw);
    else       canvas.style.display = 'none';
  }
  draw();
}

// ─────────────────────────────────────────
// DAILY MISSION
// ─────────────────────────────────────────
function getWeekData(visitDates) {
  const dates  = new Set(visitDates || []);
  const today  = getToday();
  const now    = new Date();
  const dow    = now.getDay(); // 0=Sun
  const monOff = (dow + 6) % 7; // 月曜日まで遡るオフセット
  return ['月','火','水','木','金','土','日'].map((label, i) => {
    const d = new Date(now);
    d.setDate(now.getDate() - monOff + i);
    const dateStr = d.toISOString().slice(0, 10);
    return {
      label,
      done    : dates.has(dateStr),
      isToday : dateStr === today,
      isFuture: dateStr > today
    };
  });
}

function updateMissionDots() {
  const todayAnswered = loadProgress().todayAnswered || 0;
  for (let i = 0; i < 10; i++) {
    const dot = document.getElementById('dmDot' + i);
    if (!dot) continue;
    dot.className = 'dm-dot';
    if (i < todayAnswered) {
      dot.className += i === todayAnswered - 1 ? ' filled filled-recent' : ' filled';
    }
  }
}

function showMissionComplete() {
  const p       = loadProgress();
  const todayC  = p.todayCorrect  || 0;
  const todayA  = p.todayAnswered || 0;
  const acc     = todayA > 0 ? Math.round(todayC / todayA * 100) : 0;

  document.getElementById('missionScore').textContent    = todayC + '/' + todayA;
  document.getElementById('missionAccuracy').textContent = acc + '%';
  document.getElementById('missionStreakLine').textContent = '🔥 ' + p.dailyStreak + '日連続達成！';

  // 週間ドット
  const weekEl = document.getElementById('missionWeek');
  weekEl.innerHTML = '';
  getWeekData(p.visitDates || []).forEach(d => {
    const item  = document.createElement('div');  item.className  = 'mw-day';
    const lbl   = document.createElement('div');  lbl.className   = 'mw-label'; lbl.textContent = d.label;
    const dot   = document.createElement('div');  dot.className   = 'mw-dot';
    if (d.isToday)   dot.className += ' today';
    else if (d.done) dot.className += ' done';
    item.appendChild(lbl); item.appendChild(dot);
    weekEl.appendChild(item);
  });

  // axis 弱点分析
  const MIN_ANSWERS = 5;
  const axisStats = p.axisStats || {};
  const rows = Object.keys(AXIS_USER_LABELS)
    .map(key => {
      const s = axisStats[key] || {a:0, c:0};
      return { key, label: AXIS_USER_LABELS[key], answered: s.a, rate: s.a >= MIN_ANSWERS ? Math.round(s.c / s.a * 100) : null };
    })
    .filter(r => r.rate !== null)
    .sort((a, b) => a.rate - b.rate);

  const axisWrap = document.getElementById('missionAxisWrap');
  if (rows.length >= 2) {
    axisWrap.style.display = 'block';
    document.getElementById('missionAxisRows').innerHTML = rows.map((r, i) => {
      const cls = i === 0 ? 'weak' : (i === rows.length - 1 ? 'strong' : '');
      return `<div class="mission-axis-row">
        <span class="mission-axis-name">${r.label}</span>
        <div class="mission-axis-bar-wrap"><div class="mission-axis-bar ${cls}" style="width:${r.rate}%"></div></div>
        <span class="mission-axis-pct">${r.rate}%</span>
      </div>`;
    }).join('');
    const weak = rows[0];
    const strong = rows[rows.length - 1];
    const msg = weak.rate < 60
      ? `<strong>${weak.label}</strong>が課題です。${AXIS_USER_MSGS[weak.key]}`
      : `全体的に安定しています。<strong>${strong.label}</strong>が得意分野です。`;
    document.getElementById('missionAxisMsg').innerHTML = msg;
  } else {
    axisWrap.style.display = 'none';
  }

  document.getElementById('missionOverlay').classList.add('show');

  // Firestore へ学習データを保存（セッション終了時に1回）
  const savedEmail = localStorage.getItem(EG_REG_KEY) || null;
  saveUserToFirestore(savedEmail);
}

function closeMissionComplete() {
  document.getElementById('missionOverlay').classList.remove('show');
  goToStart();
}

// ─────────────────────────────────────────
// SRS (Spaced Repetition System)
// ─────────────────────────────────────────
const SRS_KEY = 'listenup_srs';

function loadSrs() {
  try {
    return JSON.parse(localStorage.getItem(SRS_KEY) || '{}');
  } catch { return {}; }
}

function saveSrs() {
  try { localStorage.setItem(SRS_KEY, JSON.stringify(srsItems)); } catch {}
}

function addDays(n) {
  const d = new Date();
  d.setDate(d.getDate() + n);
  return d.toISOString().slice(0, 10);
}

function getSrsId(q) {
  return (q.audio || '').match(/q(\d+)\.mp3/)?.[1] || null;
}

function updateSrsItem(item, correct) {
  if (!correct) {
    return { interval: 1, reps: 0, dueDate: addDays(1) };
  }
  const reps = (item?.reps || 0) + 1;
  const interval = reps === 1 ? 1
                 : reps === 2 ? 3
                 : reps === 3 ? 7
                 : Math.min(Math.round((item.interval || 1) * 2.5), 60);
  return { interval, reps, dueDate: addDays(interval) };
}

// Firestore への書き込みを debounce（連続回答で叩きすぎない）
let _saveTimer = null;
function scheduleSave() {
  clearTimeout(_saveTimer);
  _saveTimer = setTimeout(() => saveUserToFirestore(), 3000);
}

// ─────────────────────────────────────────
// HELPERS
// ─────────────────────────────────────────
function appendKpSpans(container, kpArray) {
  (kpArray || []).forEach(kp => {
    const s = document.createElement('span');
    s.className = 'kp';
    s.textContent = kp;
    container.appendChild(s);
  });
}

function shuffle(arr) {
  const a = [...arr];
  for (let i = a.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [a[i], a[j]] = [a[j], a[i]];
  }
  return a;
}

// ─────────────────────────────────────────
// PAGE INIT
// ─────────────────────────────────────────
document.addEventListener('DOMContentLoaded', function() {
  // 問題総数を動的にセット（QUESTIONS配列の長さを使う）
  const totalQ = DATA.length;
  document.querySelectorAll('.js-total-q').forEach(el => {
    el.textContent = totalQ + '問';
  });
  const compareEl = document.getElementById('compareQCount');
  if (compareEl) compareEl.textContent = totalQ + '問（毎週追加中）';

  showReturningStats();

  // GA4: 訪問タイプイベント
  try {
    const _p = loadProgress();
    if (_p.totalAnswered === 0) {
      gtag('event', 'first_visit_quiz');
    } else {
      gtag('event', 'returning_user', {
        lifetime_questions: _p.totalAnswered,
        daily_streak: _p.dailyStreak
      });
    }
  } catch(e) {}

  document.getElementById('egForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    const email      = document.getElementById('egInput').value.trim();
    const ageGroup   = document.querySelector('input[name="egAgeGroup"]:checked')?.value || '';
    const toeicScore = document.getElementById('egToeicScore')?.value || '';
    const btn        = document.getElementById('egSubmit');
    const errorEl    = document.getElementById('egError');
    if (!email || !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
      errorEl.textContent = '有効なメールアドレスを入力してください';
      errorEl.style.display = 'block';
      return;
    }
    if (!ageGroup) {
      errorEl.textContent = '年代を選択してください';
      errorEl.style.display = 'block';
      return;
    }
    if (!toeicScore) {
      errorEl.textContent = 'TOEICスコアを選択してください';
      errorEl.style.display = 'block';
      return;
    }
    btn.disabled = true;
    btn.textContent = '送信中...';
    errorEl.style.display = 'none';
    localStorage.setItem(EG_SIGNIN_EMAIL_KEY, email);
    try {
      const _p = loadProgress();
      const _profile = {
        age_group: ageGroup, toeic_score: toeicScore,
        registration_accuracy: _p.totalAnswered > 0 ? Math.round(_p.totalCorrect / _p.totalAnswered * 100) : 0,
        registration_questions: _p.totalAnswered,
        registration_streak: _p.dailyStreak
      };
      localStorage.setItem(EG_PENDING_PROFILE_KEY, JSON.stringify(_profile));
      localStorage.setItem('listenup_profile', JSON.stringify(_profile));
    } catch(_) {}
    submitRegistration(email, ageGroup, toeicScore);
    try {
      await auth.sendSignInLinkToEmail(email, {
        url: 'https://native-real.com/listening/',
        handleCodeInApp: true
      });
      document.getElementById('egForm').style.display = 'none';
      document.getElementById('egConsent').style.display = 'none';
      document.getElementById('egEmailSent').style.display = 'block';
      document.getElementById('egSentEmail').textContent = email;
    } catch(err) {
      btn.disabled = false;
      btn.textContent = '登録して続ける →';
      errorEl.textContent = 'メールの送信に失敗しました。もう一度お試しください。';
      errorEl.style.display = 'block';
      localStorage.removeItem(EG_SIGNIN_EMAIL_KEY);
    }
  });

  // ── LP Bottom Email Form ──
  (function() {
    const form      = document.getElementById('lpEmailForm');
    const emailIn   = document.getElementById('lpEmailInput');
    const submitBtn = document.getElementById('lpEmailSubmit');
    const toeicSel  = document.getElementById('lpToeicScore');
    if (!form) return;

    const errorEl = document.getElementById('lpEmailError');

    form.addEventListener('submit', async function(e) {
      e.preventDefault();
      const email      = emailIn.value.trim();
      const age        = document.querySelector('input[name="lpAge"]:checked');
      const ageGroup   = age?.value || '';
      const toeicScore = toeicSel.value;
      const validEmail = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
      if (!validEmail) {
        errorEl.textContent = '有効なメールアドレスを入力してください';
        errorEl.style.display = 'block';
        return;
      }
      if (!ageGroup) {
        errorEl.textContent = '年代を選択してください';
        errorEl.style.display = 'block';
        return;
      }
      if (!toeicScore) {
        errorEl.textContent = 'TOEICスコアを選択してください';
        errorEl.style.display = 'block';
        return;
      }
      errorEl.style.display = 'none';
      submitBtn.disabled = true;
      submitBtn.textContent = '送信中...';
      localStorage.setItem(EG_SIGNIN_EMAIL_KEY, email);
      try {
        const _p = loadProgress();
        const _profile = {
          age_group: ageGroup, toeic_score: toeicScore,
          registration_accuracy: _p.totalAnswered > 0 ? Math.round(_p.totalCorrect / _p.totalAnswered * 100) : 0,
          registration_questions: _p.totalAnswered,
          registration_streak: _p.dailyStreak
        };
        localStorage.setItem(EG_PENDING_PROFILE_KEY, JSON.stringify(_profile));
        localStorage.setItem('listenup_profile', JSON.stringify(_profile));
      } catch(_) {}
      submitRegistration(email, ageGroup, toeicScore);
      try {
        await auth.sendSignInLinkToEmail(email, {
          url: 'https://native-real.com/listening/',
          handleCodeInApp: true
        });
        submitBtn.textContent = '📧 メールを送信しました';
        errorEl.style.color = '#4ade80';
        errorEl.textContent = email + ' に確認リンクを送りました。メール内のリンクをクリックすると練習が始まります。';
        errorEl.style.display = 'block';
      } catch(err) {
        submitBtn.disabled = false;
        submitBtn.textContent = '登録して練習を始める →';
        errorEl.style.color = '#ffb347';
        errorEl.textContent = 'メールの送信に失敗しました。もう一度お試しください。';
        errorEl.style.display = 'block';
        localStorage.removeItem(EG_SIGNIN_EMAIL_KEY);
      }
    });
  })();

  document.getElementById('egSkip').addEventListener('click', function() {
    localStorage.setItem(EG_SKIP_KEY, new Date().toDateString());
    document.getElementById('egOverlay').style.display = 'none';
    document.body.style.overflow = '';
    // GA4: メールゲートスキップイベント
    try { gtag('event', 'email_gate_skip'); } catch(e) {}
    // 案B: スキップ = 今日はここで終了（有料誘導を表示）
    showMissionComplete();
  });
});

// ── SCROLL REVEAL ──
(function() {
  const revealObs = new IntersectionObserver((entries) => {
    entries.forEach(e => {
      if (e.isIntersecting) {
        e.target.classList.add('visible');
        revealObs.unobserve(e.target);
      }
    });
  }, { threshold: 0.1, rootMargin: '0px 0px -48px 0px' });
  document.querySelectorAll('.reveal').forEach(el => revealObs.observe(el));
})();

// ── CURSOR SPOTLIGHT ──
(function() {
  const spot = document.getElementById('cursorSpot');
  if (!spot || window.matchMedia('(hover: none)').matches) return; // skip on touch
  let visible = false;
  document.addEventListener('mousemove', (e) => {
    spot.style.left = e.clientX + 'px';
    spot.style.top  = e.clientY + 'px';
    if (!visible) { spot.style.opacity = '1'; visible = true; }
  });
  document.addEventListener('mouseleave', () => {
    spot.style.opacity = '0'; visible = false;
  });
})();

  // ── LP STICKY NAV ──
  (function() {
    const nav = document.getElementById('lpNav');
    if (!nav) return;
    window.addEventListener('scroll', function() {
      if (window.scrollY > 80) nav.classList.add('visible');
      else nav.classList.remove('visible');
    }, { passive: true });
  })();

  // ── ANIMATED STATS COUNTER ──
  (function() {
    const targets = { statQ: DATA.length, statV: 5, statL: 5 };
    const suffixes = { statQ: '問', statV: '種', statL: '段階' };
    let started = false;
    function animateCount(el, target, suffix) {
      const dur = 1200;
      const start = performance.now();
      function step(now) {
        const p = Math.min((now - start) / dur, 1);
        const ease = 1 - Math.pow(1 - p, 3);
        el.textContent = Math.round(ease * target) + (suffix || '');
        if (p < 1) requestAnimationFrame(step);
        else el.textContent = target + (suffix || '');
      }
      requestAnimationFrame(step);
    }
    const statsEl = document.querySelector('.stats-strip');
    if (!statsEl) return;
    const obs = new IntersectionObserver(function(entries) {
      if (entries[0].isIntersecting && !started) {
        started = true;
        Object.keys(targets).forEach(function(id) {
          const el = document.getElementById(id);
          if (el) animateCount(el, targets[id], suffixes[id]);
        });
      }
    }, { threshold: 0.4 });
    obs.observe(statsEl);
  })();

</script>
<canvas id="confettiCanvas" style="position:fixed;inset:0;pointer-events:none;z-index:9999;display:none"></canvas>

<!-- Email Gate Modal -->
<div id="egOverlay" class="eg-overlay" style="display:none" role="dialog" aria-modal="true">
  <div class="eg-card">
    <div class="eg-orb-1"></div>
    <div class="eg-orb-2"></div>
    <div class="eg-body">
      <div class="eg-emoji">🎉</div>
      <h2 class="eg-title">5問クリア！</h2>
      <p class="eg-sub">メール登録で<span class="eg-gold">制限なし</span>で続けられます</p>
      <p class="eg-desc">英語リスニングのコツや学習法を定期的にお届けします。<br>登録は無料・いつでも解除できます。</p>
      <div class="eg-stats" id="egStats"></div>
      <form class="eg-form" id="egForm" novalidate>
        <input type="email" id="egInput" class="eg-input" placeholder="your@email.com" autocomplete="email" required>
        <div class="eg-field-group">
          <div class="eg-field-label">年代</div>
          <div class="eg-radio-row">
            <label class="eg-radio-btn"><input type="radio" name="egAgeGroup" value="10代"><span>10代</span></label>
            <label class="eg-radio-btn"><input type="radio" name="egAgeGroup" value="20代"><span>20代</span></label>
            <label class="eg-radio-btn"><input type="radio" name="egAgeGroup" value="30代"><span>30代</span></label>
            <label class="eg-radio-btn"><input type="radio" name="egAgeGroup" value="40代"><span>40代</span></label>
            <label class="eg-radio-btn"><input type="radio" name="egAgeGroup" value="50代"><span>50代</span></label>
            <label class="eg-radio-btn"><input type="radio" name="egAgeGroup" value="60代以上"><span>60代+</span></label>
          </div>
        </div>
        <div class="eg-field-group">
          <div class="eg-field-label">TOEICスコア</div>
          <select id="egToeicScore" class="eg-select">
            <option value="">選択してください</option>
            <option value="〜499点">〜499点</option>
            <option value="500〜599点">500〜599点</option>
            <option value="600〜699点">600〜699点</option>
            <option value="700〜799点">700〜799点</option>
            <option value="800〜899点">800〜899点</option>
            <option value="900〜990点">900〜990点</option>
            <option value="未受験">未受験</option>
          </select>
        </div>
        <button type="submit" class="eg-submit" id="egSubmit">登録して続ける →</button>
      </form>
      <p class="eg-consent" id="egConsent">「登録して続ける」を押すと、以下すべてに同意したものとみなします：<br>• 英語学習ニュースレターの受信（配信停止はいつでも可能）<br>• 学習データ（正解率・弱点分野・難易度進捗など）をFirebase（Google LLC）で管理・分析・サービス改善に利用<br>• 匿名化・統計処理した学習傾向データの第三者提供（個人を特定する情報は含みません）<br><a href="/privacy/" target="_blank" rel="noopener">プライバシーポリシー</a> · <a href="/privacy/#third-party" target="_blank" rel="noopener">第三者提供について</a></p>
      <div id="egEmailSent" style="display:none;text-align:center;padding:16px 0">
        <div style="font-size:2.5rem;margin-bottom:12px">📧</div>
        <p style="font-size:1.05rem;font-weight:700;margin-bottom:8px;color:#fff">メールを送信しました</p>
        <p style="font-size:.88rem;color:rgba(255,255,255,.75);margin-bottom:6px"><span id="egSentEmail" style="color:var(--gold)"></span> に確認リンクを送りました。</p>
        <p style="font-size:.82rem;color:rgba(255,255,255,.55)">メール内のリンクをクリックすると<br>練習が自動的に始まります。<br><br>届かない場合は迷惑メールフォルダをご確認ください。</p>
      </div>
      <p class="eg-error" id="egError"></p>
      <button class="eg-skip" id="egSkip">今日はここまで（登録なしで続けるには明日また来てください）</button>
    </div>
  </div>
</div>
</body>
</html>
